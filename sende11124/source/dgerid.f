c mpec2.1 version eta. For copyright and Disclaimers, see start.f
      subroutine dgerid(la,zza,xna,xa,ya,za,                            3d12s20
     $               lb,zzb,xnb,xb,yb,zb,                               3d12s20
     $               lc,zzc,xnc,xc,yc,zc,                               3d12s20
     $               ld,zzd,xnd,xd,yd,zd,                               3d12s20
     $               iax,iay,iaz,ibx,iby,ibz,icx,icy,icz,idx,idy,idz,   3d12s20
     $               icartt,ldebp,icode,fmulx,bc,ibc)                   11d14s22
      implicit real*8 (a-h,o-z)
      external second                                                   3d16s20
c
c     compute electron repulsion integrals.
c     icode=1 means just do llll, llss, and ssll for spin-free          3d13s20
c     icode=2 means just do all of llss and ssll for spin-orbit         3d13s20
c     icode=3 means just do all of Breit for spin-orbit                 3d13s20
c     icode=4 means 1 plus ssss for spin-free                           3d13s20
c     icode=5 means just do llll and llss for spin-free                 3d18s20
c     icode=6 means just do ssll for spin-free (5 and 6 together are    3d18s20
c                   cheaper than just 2, for 2 does quadrature for 4)   3d18s20
c     compute all of breit integrals in one hit.
c     there are 4x3x3x7 cases ...
c     4 being (ls|ls),(ls|sl),(sl|ls),(sl|sl)
c     3 being x,y,or z
c     7 being
c            0 = normal
c            1 = z12^2       iaz+1,4 & ibz+1,4
c            2 = x12^2+y12^2 iax+1,2 & ibx+1,2
c            3 = x12^2-y12^2 iay+1,3 & iby+1,3
c            4 = 2*x12*y12   iax+1,3 & ibx+1,3
c            5 = x12*z12     iax+1,4 & ibx+1,4
c            6 = y12*z12     iay+1,4 & iby+1,4
c     so we need to allow for 2 extra for ia and ib,
c     1 extra for ic and id, and extra for x12 etc
c     iax etc are order of differentiation of gaussian a with respect   9d8s10
c     to x etc                                                          9d8s10
c
c     and now some new codes:
c     7: just lx,ly,lz of Coulomb
c     8: just 1,lx,ly,lz of Gaunt
c     9: just 1 of Gaunt
c     10: just 1 of Breit                                               9d21s21
c
      include "common.store"
      include "common.spher"
      include "common.rys"                                              7d5s12
      logical ldeb,ldebp                                                2d26s20
      parameter (idfcn=500)                                             3d12s20
      parameter (idcode=23)                                             12d20s20
      dimension iovrm(8),ikinm(8),ioffb(8),ioffk(8),nhere(8,4),         1d13s10
     $     mhere(8,4),icoef(8,4),ipow(8,4),ltmp(4),mult(8,8),joff(8,4)  1d14s10
      dimension breit(10),ioffs(5,3,idfcn,idcode),ioffss(idfcn,idcode), 9d21s21
     $     nfcns(idcode),nfcn(idcode),fmulx(6),idad(idcode),            9d21s21
     $     ibdo(idcode),idcd(idcode),ilxyz(4),ilxyzb(4),                12d20s20
     $     cfcn(idfcn,idcode)                                           12d20s20
      dimension ncot(idcode),nncot(70,idcode),incot(1320,idcode)        11d4s21
      dimension nxyz(3,10),ngaunt(4),igaunt(12,4,4),gaunt(12,4),        12d20s20
     $     icoul(4,4,3),nbreit(4),ibreit(120,6,4),xbreit(120,4)         12d20s20
      data nxyz/0,0,0, 1,0,0, 0,1,0, 0,0,1, 1,0,1, 0,1,1, 1,1,0, 2,0,0, 12d20s20
     $     0,2,0, 0,0,2/                                                12d20s20
      data nbreit/120,3*104/                                            12d20s20
      data ((ibreit(i,j,1),j=1,6),i=1,120)/
     $ 4,0,1,0,3,1, 1,3,1,0,3,1, 4,0,3,0,1,1, 3,1,3,0,1,1,
     $5,0,2,0,3,2, 2,3,2,0,3,2, 5,0,3,0,2,2, 3,2,3,0,2,2,
     $7,0,1,0,1,3, 1,1,1,0,1,3, 8,0,2,0,2,3, 2,2,2,0,2,3, 9,0,3,0,3,3,
     $     3,3,3,0,3,3,
     $6,0,1,0,2,4, 1,2,1,0,2,4, 6,0,2,0,1,4, 2,1,2,0,1,4,
     $ 7,0,2,0,2,5, 1,1,2,0,2,5, 6,0,1,0,2,5, 2,1,1,0,2,5,
     $ 8,0,3,0,3,6, 2,2,3,0,3,6, 5,0,2,0,3,6, 3,2,2,0,3,6,
     $ 7,0,3,0,3,7, 1,1,3,0,3,7, 4,0,1,0,3,7, 3,1,1,0,3,7,
     $ 3,1,1,0,3,8, 0,4,1,0,3,8, 1,3,3,0,1,8, 0,4,3,0,1,8,
     $ 3,2,2,0,3,9, 0,5,2,0,3,9, 2,3,3,0,2,9, 0,5,3,0,2,9,
     $ 1,1,1,0,1,10, 0,7,1,0,1,10, 2,2,2,0,2,10, 0,8,2,0,2,10,
     $     3,3,3,0,3,10, 0,9,3,0,3,10,
     $ 2,1,1,0,2,11, 0,6,1,0,2,11, 1,2,2,0,1,11, 0,6,2,0,1,11,
     $ 1,1,2,0,2,12, 0,7,2,0,2,12, 1,2,1,0,2,12, 0,6,1,0,2,12,
     $ 1,1,3,0,3,13, 0,7,3,0,3,13, 1,3,1,0,3,13, 0,4,1,0,3,13,
     $ 2,2,3,0,3,14, 0,8,3,0,3,14, 2,3,2,0,3,14, 0,5,2,0,3,14,
     $ 4,0,0,1,3,15, 1,3,0,1,3,15, 4,0,0,3,1,15, 3,1,0,3,1,15,
     $ 5,0,0,3,2,16, 3,2,0,3,2,16, 5,0,0,2,3,16, 2,3,0,2,3,16,
     $ 8,0,0,2,2,17, 2,2,0,2,2,17, 7,0,0,1,1,17, 1,1,0,1,1,17,
     $     9,0,0,3,3,17, 3,3,0,3,3,17,
     $ 6,0,0,2,1,18, 2,1,0,2,1,18, 6,0,0,1,2,18, 1,2,0,1,2,18,
     $ 7,0,0,2,2,19, 1,1,0,2,2,19, 6,0,0,1,2,19, 2,1,0,1,2,19,
     $ 7,0,0,3,3,20, 1,1,0,3,3,20, 4,0,0,1,3,20, 3,1,0,1,3,20,
     $ 8,0,0,3,3,21, 2,2,0,3,3,21, 5,0,0,2,3,21, 3,2,0,2,3,21,
     $ 3,1,0,1,3,22, 0,4,0,1,3,22, 1,3,0,3,1,22, 0,4,0,3,1,22,
     $ 2,3,0,3,2,23, 0,5,0,3,2,23, 3,2,0,2,3,23, 0,5,0,2,3,23,
     $ 1,1,0,1,1,24, 0,7,0,1,1,24, 2,2,0,2,2,24, 0,8,0,2,2,24,
     $     3,3,0,3,3,24, 0,9,0,3,3,24,
     $ 2,1,0,1,2,25, 0,6,0,1,2,25, 1,2,0,2,1,25, 0,6,0,2,1,25,          12d20s20
     $ 1,1,0,2,2,26, 0,7,0,2,2,26, 1,2,0,1,2,26, 0,6,0,1,2,26,          12d20s20
     $ 2,2,0,3,3,27, 0,8,0,3,3,27, 2,3,0,2,3,27, 0,5,0,2,3,27,          12d20s20
     $ 1,1,0,3,3,28, 0,7,0,3,3,28, 1,3,0,1,3,28, 0,4,0,1,3,28/          12d20s20
      data (xbreit(i,1),i=1,120)/120*1d0/                               12d20s20
      data ((ibreit(i,j,2),j=1,6),i=1,104)/                             12d20s20
     $ 5,0,1,0,3,1, 2,3,1,0,3,1, 4,0,2,0,3,2, 1,3,2,0,3,2,              12d20s20
     $ 8,0,1,0,2,3, 2,2,1,0,2,3, 7,0,2,0,1,3, 1,1,2,0,1,3,
     $ 6,0,2,0,2,4, 1,2,2,0,2,4, 6,0,1,0,1,4, 2,1,1,0,1,4,
     $ 7,0,1,0,2,5, 1,1,1,0,2,5, 6,0,2,0,2,5, 2,1,2,0,2,5,
     $ 4,0,3,0,2,6, 3,1,3,0,2,6, 6,0,3,0,3,7, 1,2,3,0,3,7,
     $ 6,0,3,0,3,8, 2,1,3,0,3,8, 5,0,1,0,3,9, 3,2,1,0,3,9,
     $ 4,0,2,0,3,10, 3,1,2,0,3,10, 3,2,1,0,3,11, 0,5,1,0,3,11,
     $ 3,1,2,0,3,12, 0,4,2,0,3,12,
     $ 1,1,2,0,1,13, 0,7,2,0,1,13, 2,2,1,0,2,13, 0,8,1,0,2,13,
     $ 2,1,2,0,2,14, 0,6,2,0,2,14, 1,2,1,0,1,14, 0,6,1,0,1,14,
     $ 1,2,2,0,2,15, 0,6,2,0,2,15, 1,1,1,0,2,15, 0,7,1,0,2,15,
     $ 1,3,3,0,2,16, 0,4,3,0,2,16, 2,1,3,0,3,17, 0,6,3,0,3,17,
     $ 1,2,3,0,3,18, 0,6,3,0,3,18, 2,3,1,0,3,19, 0,5,1,0,3,19,
     $ 1,3,2,0,3,20, 0,4,2,0,3,20, 5,0,0,1,3,21, 2,3,0,1,3,21,
     $ 4,0,0,2,3,22, 1,3,0,2,3,22,
     $ 8,0,0,1,2,23, 2,2,0,1,2,23, 7,0,0,2,1,23, 1,1,0,2,1,23,
     $ 6,0,0,1,1,24, 2,1,0,1,1,24, 6,0,0,2,2,24, 1,2,0,2,2,24,
     $ 7,0,0,1,2,25, 1,1,0,1,2,25, 6,0,0,2,2,25, 2,1,0,2,2,25,
     $ 4,0,0,3,2,26, 3,1,0,3,2,26, 6,0,0,3,3,27, 1,2,0,3,3,27,
     $ 6,0,0,3,3,28, 2,1,0,3,3,28, 5,0,0,1,3,29, 3,2,0,1,3,29,
     $ 4,0,0,2,3,30, 3,1,0,2,3,30, 3,2,0,1,3,31, 0,5,0,1,3,31,
     $ 3,1,0,2,3,32, 0,4,0,2,3,32,                                      12d20s20
     $ 1,1,0,2,1,33, 0,7,0,2,1,33, 2,2,0,1,2,33, 0,8,0,1,2,33,          12d20s20
     $ 1,2,0,1,1,34, 0,6,0,1,1,34, 2,1,0,2,2,34, 0,6,0,2,2,34,          12d20s20
     $ 1,2,0,2,2,35, 0,6,0,2,2,35, 1,1,0,1,2,35, 0,7,0,1,2,35,          12d20s20
     $ 1,3,0,3,2,36, 0,4,0,3,2,36, 2,1,0,3,3,37, 0,6,0,3,3,37,          12d20s20
     $ 1,2,0,3,3,38, 0,6,0,3,3,38, 2,3,0,1,3,39, 0,5,0,1,3,39,          12d20s20
     $ 1,3,0,2,3,40, 0,4,0,2,3,40/                                      12d20s20
      data (xbreit(i,2),i=1,104)/4*1d0,2*1d0,2*-1d0,2*1d0,2*-1d0,2*1d0, 12d20s20
     $    2*-1d0,2*1d0,2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0,2*1d0,2*1d0,   12d20s20
     $    2*-1d0, 2*1d0,2*-1d0, 2*1d0,2*-1d0, 2*1d0, 2*1d0, 2*1d0,      12d20s20
     $    2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0,2*-1d0, 2*1d0, 2*-1d0,      12d20s20
     $    2*1d0,2*-1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0,       12d20s20
     $    2*1d0, 2*1d0, 2*-1d0, 2*1d0, 2*-1d0, 2*1d0, 2*-1d0, 2*1d0,    12d20s20
     $    2*1d0, 2*1d0, 2*1d0, 2*1d0/                                   12d20s20
      data ((ibreit(i,j,3),j=1,6),i=1,104)/
     $ 5,0,1,0,2,1, 3,2,1,0,2,1,                                        12d20s20
     $ 4,0,3,0,3,2, 1,3,3,0,3,2, 4,0,1,0,1,2, 3,1,1,0,1,2,              12d20s20
     $ 9,0,1,0,3,3, 3,3,1,0,3,3, 7,0,3,0,1,3, 1,1,3,0,1,3,              12d20s20
     $ 6,0,3,0,2,4, 1,2,3,0,2,4, 6,0,3,0,2,5, 2,1,3,0,2,5,              12d20s20
     $ 4,0,2,0,2,6, 3,1,2,0,2,6, 7,0,1,0,3,7, 1,1,1,0,3,7,              12d20s20
     $ 6,0,2,0,3,8, 1,2,2,0,3,8, 8,0,1,0,3,9, 2,2,1,0,3,9,              12d20s20
     $ 6,0,2,0,3,10, 2,1,2,0,3,10, 4,0,3,0,3,11, 3,1,3,0,3,11,          12d20s20
     $ 1,1,3,0,1,12, 0,7,3,0,1,12, 3,3,1,0,3,12, 0,9,1,0,3,12,          12d20s20
     $ 2,1,3,0,2,13, 0,6,3,0,2,13, 2,3,1,0,2,14, 0,5,1,0,2,14,          12d20s20
     $ 3,1,3,0,3,15, 0,4,3,0,3,15, 1,3,1,0,1,15, 0,4,1,0,1,15,          12d20s20
     $ 1,3,2,0,2,16, 0,4,2,0,2,16, 1,2,3,0,2,17, 0,6,3,0,2,17,          12d20s20
     $ 1,1,1,0,3,18, 0,7,1,0,3,18, 2,1,2,0,3,19, 0,6,2,0,3,19,          12d20s20
     $ 2,2,1,0,3,20, 0,8,1,0,3,20, 1,2,2,0,3,21, 0,6,2,0,3,21,          12d20s20
     $ 1,3,3,0,3,22, 0,4,3,0,3,22,
     $ 9,0,0,1,3,23, 3,3,0,1,3,23, 7,0,0,3,1,23, 1,1,0,3,1,23,
     $ 6,0,0,3,2,24, 1,2,0,3,2,24, 5,0,0,1,2,25, 3,2,0,1,2,25,
     $ 4,0,0,1,1,26, 3,1,0,1,1,26, 4,0,0,3,3,26, 1,3,0,3,3,26,
     $ 4,0,0,2,2,27, 3,1,0,2,2,27, 6,0,0,3,2,28, 2,1,0,3,2,28,
     $ 7,0,0,1,3,29, 1,1,0,1,3,29, 6,0,0,2,3,30, 1,2,0,2,3,30,
     $ 8,0,0,1,3,31, 2,2,0,1,3,31, 6,0,0,2,3,32, 2,1,0,2,3,32,
     $ 4,0,0,3,3,33, 3,1,0,3,3,33,
     $ 1,1,0,3,1,34, 0,7,0,3,1,34, 3,3,0,1,3,34, 0,9,0,1,3,34,
     $ 2,1,0,3,2,35, 0,6,0,3,2,35, 2,3,0,1,2,36, 0,5,0,1,2,36,
     $ 1,3,0,1,1,37, 0,4,0,1,1,37, 3,1,0,3,3,37, 0,4,0,3,3,37,
     $ 1,2,0,3,2,38, 0,6,0,3,2,38, 1,3,0,2,2,39, 0,4,0,2,2,39,
     $ 1,1,0,1,3,40, 0,7,0,1,3,40, 2,1,0,2,3,41, 0,6,0,2,3,41,
     $ 2,2,0,1,3,42, 0,8,0,1,3,42, 1,2,0,2,3,43, 0,6,0,2,3,43,
     $ 1,3,0,3,3,44, 0,4,0,3,3,44/
      data (xbreit(i,3),i=1,104)/2*1d0, 2*1d0, 2*-1d0, 2*1d0, 2*-1d0,      12d20s20
     $    2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0,       12d20s20
     $    2*1d0, 2*-1d0, 2*1d0, 2*1d0, 2*1d0, 2*-1d0,2*1d0, 2*1d0,      12d20s20
     $    2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*-1d0, 2*1d0,      12d20s20
     $    2*1d0, 2*1d0, 2*-1d0, 2*1d0, 2*1d0,2*1d0, 2*1d0, 2*1d0,       12d20s20
     $    2*1d0, 2*1d0, 2*1d0, 2*-1d0, 2*1d0, 2*1d0, 2*1d0, 2*-1d0,     12d20s20
     $    2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0/              12d20s20
      data ((ibreit(i,j,4),j=1,6),i=1,104)/                              12d20s20
     $ 9,0,2,0,3,1, 3,3,2,0,3,1, 8,0,3,0,2,1, 2,2,3,0,2,1,
     $ 6,0,3,0,1,2, 2,1,3,0,1,2,
     $ 5,0,3,0,3,3, 2,3,3,0,3,3, 5,0,2,0,2,3, 3,2,2,0,2,3,
     $ 4,0,2,0,1,4, 3,1,2,0,1,4, 7,0,3,0,2,5, 1,1,3,0,2,5,
     $ 4,0,1,0,2,6, 3,1,1,0,2,6, 6,0,1,0,3,7, 1,2,1,0,3,7,
     $ 7,0,2,0,3,8, 1,1,2,0,3,8, 6,0,1,0,3,9, 2,1,1,0,3,9,
     $ 8,0,2,0,3,10, 2,2,2,0,3,10, 5,0,3,0,3,11, 3,2,3,0,3,11,
     $ 2,2,3,0,2,12, 0,8,3,0,2,12, 3,3,2,0,3,12, 0,9,2,0,3,12,
     $ 1,2,3,0,1,13, 0,6,3,0,1,13,
     $ 3,2,3,0,3,14, 0,5,3,0,3,14, 2,3,2,0,2,14, 0,5,2,0,2,14,
     $ 1,3,2,0,1,15, 0,4,2,0,1,15, 1,3,1,0,2,16, 0,4,1,0,2,16,
     $ 1,1,3,0,2,17, 0,7,3,0,2,17, 2,1,1,0,3,18, 0,6,1,0,3,18,
     $ 1,1,2,0,3,19, 0,7,2,0,3,19, 1,2,1,0,3,20, 0,6,1,0,3,20,
     $ 2,2,2,0,3,21, 0,8,2,0,3,21, 2,3,3,0,3,22, 0,5,3,0,3,22,
     $ 9,0,0,2,3,23, 3,3,0,2,3,23, 8,0,0,3,2,23, 2,2,0,3,2,23,
     $ 6,0,0,3,1,24, 2,1,0,3,1,24,
     $ 5,0,0,2,2,25, 3,2,0,2,2,25, 5,0,0,3,3,25, 2,3,0,3,3,25,
     $ 4,0,0,2,1,26, 3,1,0,2,1,26, 4,0,0,1,2,27, 3,1,0,1,2,27,
     $ 7,0,0,3,2,28, 1,1,0,3,2,28, 6,0,0,1,3,29, 1,2,0,1,3,29,
     $ 7,0,0,2,3,30, 1,1,0,2,3,30, 6,0,0,1,3,31, 2,1,0,1,3,31,
     $ 8,0,0,2,3,32, 2,2,0,2,3,32, 5,0,0,3,3,33, 3,2,0,3,3,33,
     $ 2,2,0,3,2,34, 0,8,0,3,2,34, 3,3,0,2,3,34, 0,9,0,2,3,34,
     $ 1,2,0,3,1,35, 0,6,0,3,1,35,
     $ 2,3,0,2,2,36, 0,5,0,2,2,36, 3,2,0,3,3,36, 0,5,0,3,3,36,
     $ 1,3,0,2,1,37, 0,4,0,2,1,37, 1,3,0,1,2,38, 0,4,0,1,2,38,
     $ 1,1,0,3,2,39, 0,7,0,3,2,39, 2,1,0,1,3,40, 0,6,0,1,3,40,
     $ 1,1,0,2,3,41, 0,7,0,2,3,41, 1,2,0,1,3,42, 0,6,0,1,3,42,
     $ 2,2,0,2,3,43, 0,8,0,2,3,43, 2,3,0,3,3,44, 0,5,0,3,3,44/
      data (xbreit(i,4),i=1,104)/ 2*1d0, 2*-1d0, 2*1d0, 2*1d0, 2*-1d0,     12d20s20
     $    2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0,       12d20s20
     $    2*1d0, 2*-1d0, 2*1d0,2*1d0, 2*-1d0, 2*1d0, 2*1d0, 2*1d0,      12d20s20
     $    2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*-1d0, 2*1d0,      12d20s20
     $    2*1d0, 2*-1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0,      12d20s20
     $    2*1d0, 2*1d0, 2*1d0, 2*-1d0, 2*1d0, 2*1d0, 2*-1d0, 2*1d0,     12d20s20
     $    2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0, 2*1d0/              12d20s20
      data ((icoul(i,j,1),j=1,4),i=1,4)/1,2,0,0, 2,1,0,0, 0,0,1,2,      12d20s20
     $     0,0,2,1/                                                     12d20s20
      data ((icoul(i,j,2),j=1,4),i=1,4)/1,3,0,0, 3,1,0,0, 0,0,1,3,      12d20s20
     $     0,0,3,1/                                                     12d20s20
      data ((icoul(i,j,3),j=1,4),i=1,4)/2,3,0,0, 3,2,0,0, 0,0,2,3,      12d20s20
     $     0,0,3,2/                                                     12d20s20
      data ngaunt/12,8,8,8/                                             12d20s20
      data ((igaunt(i,j,1),j=1,4),i=1,12)/1,0,1,0, 2,0,2,0, 3,0,3,0,    12d20s20
     $     0,1,1,0, 0,2,2,0, 0,3,3,0, 1,0,0,1, 2,0,0,2, 3,0,0,3,        12d20s20
     $     0,1,0,1, 0,2,0,2, 0,3,0,3/                                   12d20s20
      data (gaunt(i,1),i=1,12)/1d0,1d0,1d0,1d0,-1d0,-1d0,1d0,-1d0,-1d0, 12d20s20
     $     1d0,1d0,1d0/                                                 12d20s20
      data ((igaunt(i,j,2),j=1,4),i=1,8)/1,0,2,0, 2,0,1,0, 0,1,2,0,     12d20s20
     $     0,2,1,0, 1,0,0,2, 2,0,0,1, 0,1,0,2, 0,2,0,1/                 12d20s20
      data (gaunt(i,2),i=1,8)/8*1d0/                                    12d20s20
      data ((igaunt(i,j,3),j=1,4),i=1,8)/1,0,3,0, 3,0,1,0, 0,1,3,0,     12d20s20
     $     0,3,1,0, 1,0,0,3, 3,0,0,1, 0,1,0,3, 0,3,0,1/                 12d20s20
      data (gaunt(i,3),i=1,8)/8*1d0/                                    12d20s20
      data ((igaunt(i,j,4),j=1,4),i=1,8)/2,0,3,0, 3,0,2,0, 0,2,3,0,     12d20s20
     $     0,3,2,0, 2,0,0,3, 3,0,0,2, 0,2,0,3, 0,3,0,2/                 12d20s20
      data (gaunt(i,4),i=1,8)/2*1d0,1d0,-1d0,+1d0,1d0,2*1d0/            12d20s20
      data ncot/6*0,6,0,0,16,70,12*0/                                   12d20s20
      data (nncot(j,7),j=1,6)/6*2/                                      11d4s21
      data (incot(j,7),j=1,24)/0,2,2,-2, 6,2,8,-2,                      11d4s21
     $     1,-2,4,2, 7,-2,10,2, 3,2,5,-2, 9,2,11,-2/                    11d4s21
      data (nncot(j,9),j=1,16)                                          11d5s21
     $     /3, 2, 3, 1, 3, 2, 3, 1, 3, 2, 3, 1, 3, 2,  3, 1/
      data (incot(j,9),j=1,72)                                          11d5s21
     $     /12, 4,16, 4,20, 2,12, 2,16,-2,12,-2,16,-2,20,-4,20, 2,21,-4,
     $      25,-4,29,-2,21, 2,25,-2,21,-2,25,-2,29,-4,29,-2,30,-4,34,-4,
     $      38,-2,30, 2,34,-2,30,-2,34,-2,38,-4,38,-2,39, 4,43, 4,47, 2,
     $      39, 2,43,-2,39,-2,43,-2,47,-4,47, 2/
      data (nncot(j,8),j=1,66)                                          11d5s21
     $     /3, 2, 3, 1, 3, 2, 3, 1, 3, 2, 3, 1, 3, 2,  3, 1,
     $     2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
     $     2, 2, 2, 1, 2, 1, 2, 2, 1, 1, 2, 1, 2, 1, 2, 2, 1, 1,
     $     2, 2, 2, 1, 2, 1, 2, 2, 1, 1, 2, 1, 2, 1, 2, 2, 1, 1/
      data (incot(j,8),j=1,240)                                         11d5s21
     $     /12, 4,16, 4,20, 2,12, 2,16,-2,12,-2,16,-2,20,-4,20, 2,21,-4,
     $      25,-4,29,-2,21, 2,25,-2,21,-2,25,-2,29,-4,29,-2,30,-4,34,-4,
     $      38,-2,30, 2,34,-2,30,-2,34,-2,38,-4,38,-2,39, 4,43, 4,47, 2,
     $      39, 2,43,-2,39,-2,43,-2,47,-4,47, 2,
     $     0, 2, 2,-2, 6, 2, 8,-2,13,-4,15, 4,13,-2,15,-2,13,-2,15, 2,
     $    22, 4,24,-4,22,-2,24,-2,22,-2,24, 2,31,-4,33, 4,31,-2,33,-2,
     $    31,-2,33, 2,40, 4,42,-4,40,-2,42,-2,40,-2,42, 2,
     $     1,-2, 4, 2, 7,-2,10, 2,14, 4,18,-2,14, 2,14, 2,18,-4,18, 2,
     $    23, 4,27,-2,23,-2,27, 4,23,-2,27, 2,32, 4,36,-2,32, 2,32, 2,
     $    36,-4,36, 2,41, 4,45,-2,41,-2,45, 4,41,-2,45, 2,
     $     3, 2, 5,-2, 9, 2,11,-2,17, 4,19,-2,17,-2,17,-2,19, 4,19,-2,
     $    26, 4,28,-2,26, 2,28,-4,26, 2,28,-2,35,-4,37, 2,35,-2,35,-2,
     $    37, 4,37, 2,44,-4,46, 2,44, 2,46,-4,44, 2,46, 2/
      data (nncot(j,10),j=1,16)
     $     /12,10,11,12,12,10,11,12,12,10,11,12,12,10,11,12/
      data (incot(j,10),j=1,360)
     $     /12,  4, 14,  1, 15,  1, 30,  1, 40,  4, 42,  1, 43,  1, 52,
     $  1, 58,  1, 66,  1, 68,  2, 69,  1, 12,  2, 13,  1, 30, -1,
     $ 40, -2, 41, -1, 52,  1, 58, -1, 66,  1, 70,  1, 71, -1, 12,
     $ -2, 13, -1, 30,  1, 40, -2, 41, -1, 52,  1, 58,  1, 66,  1,
     $ 68, -4, 70, -1, 71, -1, 14,  1, 15, -1, 25,  2, 30,  1, 39,
     $  2, 42, -1, 43,  1, 52,  1, 58,  1, 66,  1, 68,  2, 69,  1,
     $ 75, -4, 77, -1, 78, -1, 93, -1,103, -4,105, -1,106, -1,115,
     $ -1,121, -1,129, -1,131, -2,132, -1, 75,  2, 76,  1, 93, -1,
     $103, -2,104, -1,115,  1,121, -1,129,  1,133,  1,134, -1, 75,
     $ -2, 76, -1, 93,  1,103, -2,104, -1,115,  1,121,  1,129,  1,
     $131, -4,133, -1,134, -1, 77, -1, 78,  1, 88, -2, 93, -1,102,
     $ -2,105,  1,106, -1,115, -1,121, -1,129, -1,131, -2,132, -1,
     $138, -4,140, -1,141, -1,156, -1,166, -4,168, -1,169, -1,178,
     $ -1,184, -1,192, -1,194, -2,195, -1,138,  2,139,  1,156, -1,
     $166, -2,167, -1,178,  1,184, -1,192,  1,196,  1,197, -1,138,
     $ -2,139, -1,156,  1,166, -2,167, -1,178,  1,184,  1,192,  1,
     $194, -4,196, -1,197, -1,140, -1,141,  1,151, -2,156, -1,165,
     $ -2,168,  1,169, -1,178, -1,184, -1,192, -1,194, -2,195, -1,
     $201,  4,203,  1,204,  1,219,  1,229,  4,231,  1,232,  1,241,
     $  1,247,  1,255,  1,257,  2,258,  1,201,  2,202,  1,219, -1,
     $229, -2,230, -1,241,  1,247, -1,255,  1,259,  1,260, -1,201,
     $ -2,202, -1,219,  1,229, -2,230, -1,241,  1,247,  1,255,  1,
     $257, -4,259, -1,260, -1,203,  1,204, -1,214,  2,219,  1,228,
     $     2,231, -1,232,  1,241,  1,247,  1,255,  1,257,  2,258,  1/
      data (nncot(j,11),j=1,70)
     $     /12,10,11,12,12,10,11,12,12,10,11,12,12,10,11,12,
     $     2, 2,10,10, 9, 8,10,10, 9, 8,10,10, 9, 8,10,10, 9, 8,
     $     2, 2,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,
     $     2, 2,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10/
      data (incot(j,11),j=1,360)
     $     /12,  4, 14,  1, 15,  1, 30,  1, 40,  4, 42,  1, 43,  1, 52,
     $  1, 58,  1, 66,  1, 68,  2, 69,  1, 12,  2, 13,  1, 30, -1,
     $ 40, -2, 41, -1, 52,  1, 58, -1, 66,  1, 70,  1, 71, -1, 12,
     $ -2, 13, -1, 30,  1, 40, -2, 41, -1, 52,  1, 58,  1, 66,  1,
     $ 68, -4, 70, -1, 71, -1, 14,  1, 15, -1, 25,  2, 30,  1, 39,
     $  2, 42, -1, 43,  1, 52,  1, 58,  1, 66,  1, 68,  2, 69,  1,
     $ 75, -4, 77, -1, 78, -1, 93, -1,103, -4,105, -1,106, -1,115,
     $ -1,121, -1,129, -1,131, -2,132, -1, 75,  2, 76,  1, 93, -1,
     $103, -2,104, -1,115,  1,121, -1,129,  1,133,  1,134, -1, 75,
     $ -2, 76, -1, 93,  1,103, -2,104, -1,115,  1,121,  1,129,  1,
     $131, -4,133, -1,134, -1, 77, -1, 78,  1, 88, -2, 93, -1,102,
     $ -2,105,  1,106, -1,115, -1,121, -1,129, -1,131, -2,132, -1,
     $138, -4,140, -1,141, -1,156, -1,166, -4,168, -1,169, -1,178,
     $ -1,184, -1,192, -1,194, -2,195, -1,138,  2,139,  1,156, -1,
     $166, -2,167, -1,178,  1,184, -1,192,  1,196,  1,197, -1,138,
     $ -2,139, -1,156,  1,166, -2,167, -1,178,  1,184,  1,192,  1,
     $194, -4,196, -1,197, -1,140, -1,141,  1,151, -2,156, -1,165,
     $ -2,168,  1,169, -1,178, -1,184, -1,192, -1,194, -2,195, -1,
     $201,  4,203,  1,204,  1,219,  1,229,  4,231,  1,232,  1,241,
     $  1,247,  1,255,  1,257,  2,258,  1,201,  2,202,  1,219, -1,
     $229, -2,230, -1,241,  1,247, -1,255,  1,259,  1,260, -1,201,
     $ -2,202, -1,219,  1,229, -2,230, -1,241,  1,247,  1,255,  1,
     $257, -4,259, -1,260, -1,203,  1,204, -1,214,  2,219,  1,228,
     $     2,231, -1,232,  1,241,  1,247,  1,255,  1,257,  2,258,  1/
      data (incot(j,11),j=361,664)
     $     /0,  2,  2, -2,  6,  2,  8, -2, 18, -2, 21,  1, 22, -1, 31,
     $ -1, 35,  1, 36, -1, 46,  2, 51,  1, 59, -1, 65,  1, 19, -4,
     $ 21, -1, 22, -1, 31, -1, 33,  4, 35,  1, 36,  1, 51,  1, 59,
     $  1, 65, -1, 19, -2, 20, -1, 31,  1, 33, -2, 34, -1, 51,  1,
     $ 59,  1, 65,  1, 74, -2, 19, -2, 20, -1, 31,  1, 33,  2, 34,
     $  1, 51, -1, 59, -1, 65,  1, 81,  2, 84, -1, 85,  1, 94,  1,
     $ 98, -1, 99,  1,109, -2,114, -1,122,  1,128, -1, 82,  4, 84,
     $  1, 85,  1, 94,  1, 96, -4, 98, -1, 99, -1,114, -1,122, -1,
     $128,  1, 82, -2, 83, -1, 94,  1, 96, -2, 97, -1,114,  1,122,
     $  1,128,  1,137, -2, 82, -2, 83, -1, 94,  1, 96,  2, 97,  1,
     $114, -1,122, -1,128,  1,144, -2,147,  1,148, -1,157, -1,161,
     $  1,162, -1,172,  2,177,  1,185, -1,191,  1,145, -4,147, -1,
     $148, -1,157, -1,159,  4,161,  1,162,  1,177,  1,185,  1,191,
     $ -1,145, -2,146, -1,157,  1,159, -2,160, -1,177,  1,185,  1,
     $191,  1,200, -2,145, -2,146, -1,157,  1,159,  2,160,  1,177,
     $ -1,185, -1,191,  1,207,  2,210, -1,211,  1,220,  1,224, -1,
     $225,  1,235, -2,240, -1,248,  1,254, -1,208,  4,210,  1,211,
     $  1,220,  1,222, -4,224, -1,225, -1,240, -1,248, -1,254,  1,
     $208, -2,209, -1,220,  1,222, -2,223, -1,240,  1,248,  1,254,
     $  1,263, -2,208, -2,209, -1,220,  1,222,  2,223,  1,240, -1,
     $248, -1,254,  1/
      data (incot(j,11),j=665,992)
     $     /1, -2,  4,  2,  7, -2, 10,  2, 16,  1, 24, -1, 28, -1, 29,
     $  1, 38,  1, 44,  1, 53, -2, 54,  2, 55,  1, 72, -1, 16, -1,
     $ 24, -1, 26,  4, 28,  1, 29,  1, 38, -1, 44,  1, 54, -2, 55,
     $ -1, 72,  1, 16,  1, 24,  1, 26,  2, 27,  1, 38, -1, 44,  1,
     $ 56, -1, 57,  1, 67, -2, 72, -1, 16,  1, 24,  1, 26,  2, 27,
     $  1, 38,  1, 44, -1, 54, -4, 56, -1, 57, -1, 72, -1, 79,  1,
     $ 87, -1, 91, -1, 92,  1,101,  1,107,  1,116, -2,117,  2,118,
     $  1,135, -1, 79, -1, 87, -1, 89,  4, 91,  1, 92,  1,101, -1,
     $107,  1,117, -2,118, -1,135,  1, 79, -1, 87, -1, 89, -2, 90,
     $ -1,101, -1,107,  1,117,  4,119,  1,120,  1,135,  1, 79, -1,
     $ 87, -1, 89, -2, 90, -1,101,  1,107, -1,119,  1,120, -1,130,
     $  2,135,  1,142, -1,150, -1,152,  4,154,  1,155,  1,164, -1,
     $170,  1,180, -2,181, -1,198,  1,142,  1,150, -1,154, -1,155,
     $  1,164,  1,170,  1,179, -2,180,  2,181,  1,198, -1,142,  1,
     $150,  1,152,  2,153,  1,164, -1,170,  1,182, -1,183,  1,193,
     $ -2,198, -1,142,  1,150,  1,152,  2,153,  1,164,  1,170, -1,
     $180, -4,182, -1,183, -1,198, -1,205, -1,213, -1,215,  4,217,
     $  1,218,  1,227, -1,233,  1,243, -2,244, -1,261,  1,205,  1,
     $213, -1,217, -1,218,  1,227,  1,233,  1,242, -2,243,  2,244,
     $  1,261, -1,205, -1,213, -1,215, -2,216, -1,227, -1,233,  1,
     $243,  4,245,  1,246,  1,261,  1,205, -1,213, -1,215, -2,216,
     $ -1,227,  1,233, -1,245,  1,246, -1,256,  2,261,  1/
      data (incot(j,11),j=993,1320)
     $     /3,  2,  5, -2,  9,  2, 11, -2, 17, -1, 23, -1, 32,  2, 37,
     $  1, 45, -1, 49, -1, 50,  1, 61, -2, 62, -1, 73,  1, 17,  1,
     $ 23, -1, 37, -1, 45, -1, 47,  4, 49,  1, 50,  1, 61, -2, 62,
     $ -1, 73,  1, 17, -1, 23,  1, 37, -1, 45, -1, 47, -2, 48, -1,
     $ 60,  2, 63, -1, 64,  1, 73,  1, 17,  1, 23, -1, 37, -1, 45,
     $ -1, 47, -2, 48, -1, 61,  4, 63,  1, 64,  1, 73,  1, 80, -1,
     $ 86, -1, 95,  2,100,  1,108, -1,112, -1,113,  1,124, -2,125,
     $ -1,136,  1, 80,  1, 86, -1,100, -1,108, -1,110,  4,112,  1,
     $113,  1,124, -2,125, -1,136,  1, 80, -1, 86,  1,100,  1,108,
     $  1,110,  2,111,  1,124, -4,126, -1,127, -1,136, -1, 80,  1,
     $ 86, -1,100,  1,108,  1,110,  2,111,  1,123, -2,126,  1,127,
     $ -1,136, -1,143, -1,149,  1,163,  1,171,  1,173, -4,175, -1,
     $176, -1,187,  2,188,  1,199, -1,143,  1,149,  1,158, -2,163,
     $ -1,171,  1,175,  1,176, -1,187,  2,188,  1,199, -1,143, -1,
     $149,  1,163, -1,171, -1,173, -2,174, -1,186,  2,189, -1,190,
     $  1,199,  1,143,  1,149, -1,163, -1,171, -1,173, -2,174, -1,
     $187,  4,189,  1,190,  1,199,  1,206, -1,212,  1,226,  1,234,
     $  1,236, -4,238, -1,239, -1,250,  2,251,  1,262, -1,206,  1,
     $212,  1,221, -2,226, -1,234,  1,238,  1,239, -1,250,  2,251,
     $  1,262, -1,206, -1,212,  1,226,  1,234,  1,236,  2,237,  1,
     $250, -4,252, -1,253, -1,262, -1,206,  1,212, -1,226,  1,234,
     $  1,236,  2,237,  1,249, -2,252,  1,253, -1,262, -1/
      common/xcom/iadd1,iadd2,iadd3
      data mult/1,2,3,4,5,6,7,8, 2,1,4,3,6,5,8,7,                       1d13s10
     $          3,4,1,2,7,8,5,6, 4,3,2,1,8,7,6,5,                       1d13s10
     $          5,6,7,8,1,2,3,4, 6,5,8,7,2,1,4,3,                       1d13s10
     $          7,8,5,6,3,4,1,2, 8,7,6,5,4,3,2,1/                       1d13s10
      data ifirst/0/
      save
      if(ifirst.eq.0)then
       do l=1,6                                                         3d13s20
        do i=1,idfcn                                                     3d12s20
         do j=1,3                                                        3d12s20
          do k=1,5                                                       3d12s20
           ioffs(k,j,i,l)=0                                                3d12s20
          end do                                                         3d12s20
         end do                                                          3d12s20
        end do                                                          3d13s20
       end do                                                           3d12s20
       nfcn(1)=1                                                        3d13s20
       ioffss(1,1)=0                                                    3d13s20
       do ixyz=1,3                                                      3d13s20
        nfcn(1)=nfcn(1)+1                                                3d13s20
        ioffss(nfcn(1),1)=1                                             3d13s20
        ioffss(nfcn(1),4)=1                                             3d13s20
        ioffss(nfcn(1),5)=1                                             3d18s20
        ioffs(3,ixyz,nfcn(1),1)=1                                       3d13s20
        ioffs(4,ixyz,nfcn(1),1)=1                                       3d13s20
        ioffs(3,ixyz,nfcn(1),4)=1                                       3d13s20
        ioffs(4,ixyz,nfcn(1),4)=1                                       3d13s20
        ioffs(3,ixyz,nfcn(1),5)=1                                       3d13s20
        ioffs(4,ixyz,nfcn(1),5)=1                                       3d13s20
       end do                                                           3d13s20
       nfcn(5)=nfcn(1)                                                  3d18s20
       nfcns(5)=1                                                       3d18s20
       nfcn(6)=0                                                        3d18s20
       do ixyz=1,3                                                      3d13s20
        nfcn(1)=nfcn(1)+1                                                3d13s20
        ioffss(nfcn(1),1)=2                                             3d13s20
        ioffs(1,ixyz,nfcn(1),1)=1                                       3d13s20
        ioffs(2,ixyz,nfcn(1),1)=1                                       3d13s20
        ioffss(nfcn(1),4)=2                                             3d13s20
        ioffs(1,ixyz,nfcn(1),4)=1                                       3d13s20
        ioffs(2,ixyz,nfcn(1),4)=1                                       3d13s20
        nfcn(6)=nfcn(6)+1                                               3d18s20
        ioffss(nfcn(6),6)=0                                             3d18s20
        ioffs(1,ixyz,nfcn(6),6)=1                                       3d13s20
        ioffs(2,ixyz,nfcn(6),6)=1                                       3d13s20
       end do                                                           3d13s20
       nfcns(1)=2                                                       3d13s20
       nfcns(4)=3                                                       3d13s20
       nfcns(6)=0                                                       3d18s20
       nfcn(4)=nfcn(1)                                                  3d13s20
       do ixyz=1,3                                                      3d13s20
        do jxyz=1,3                                                     3d13s20
         nfcn(4)=nfcn(4)+1                                              3d13s20
         ioffss(nfcn(4),4)=3                                            3d13s20
         ioffs(1,ixyz,nfcn(4),4)=1                                      3d13s20
         ioffs(2,ixyz,nfcn(4),4)=1                                      3d13s20
         ioffs(3,jxyz,nfcn(4),4)=1                                      3d13s20
         ioffs(4,jxyz,nfcn(4),4)=1                                      3d13s20
        end do                                                          3d13s20
       end do                                                           3d13s20
       nfcn(2)=0                                                        3d13s20
       do ixyz=1,3                                                      3d13s20
        do jxyz=1,3
         nfcn(2)=nfcn(2)+1                                              3d13s20
         ioffs(3,ixyz,nfcn(2),2)=1                                      3d13s20
         ioffs(4,jxyz,nfcn(2),2)=1                                      3d13s20
         ioffss(nfcn(2),2)=nfcn(2)-1                                    3d13s20
        end do
       end do
       do ixyz=1,3                                                      3d13s20
        do jxyz=1,3
         nfcn(2)=nfcn(2)+1                                              3d13s20
         ioffs(1,ixyz,nfcn(2),2)=1                                      3d13s20
         ioffs(2,jxyz,nfcn(2),2)=1                                      3d13s20
         ioffss(nfcn(2),2)=nfcn(2)-1                                    3d13s20
        end do
       end do
       nfcns(2)=nfcn(2)-1                                               3d13s20
       nfcn(3)=0                                                        3d13s20
       nfcns(3)=0                                                       3d13s20
       do iab=2,1,-1                                                    3d13s20
        do icd=4,3,-1                                                   3d13s20
         do ixyz=1,3                                                      3d13s20
          do jxyz=1,3
           nfcn(3)=nfcn(3)+1                                            3d13s20
           ioffs(iab,ixyz,nfcn(3),3)=1                                                3d12s20
           ioffs(icd,jxyz,nfcn(3),3)=1                                                3d12s20
           ioffss(nfcn(3),3)=nfcns(3)                                   3d13s20
           nfcns(3)=nfcns(3)+1                                          3d13s20
           nfcn(3)=nfcn(3)+1                                                      3d12s20
           ioffs(iab,ixyz,nfcn(3),3)=1                                                3d12s20
           ioffs(icd,jxyz,nfcn(3),3)=1                                                3d12s20
           ioffs(1,3,nfcn(3),3)=ioffs(1,3,nfcn(3),3)+1
           ioffs(5,3,nfcn(3),3)=1
           ioffss(nfcn(3),3)=nfcns(3)                                   3d13s20
           nfcn(3)=nfcn(3)+1                                                      3d12s20
           ioffs(iab,ixyz,nfcn(3),3)=1                                       3d13s20
           ioffs(icd,jxyz,nfcn(3),3)=1                                       3d13s20
           ioffs(2,3,nfcn(3),3)=ioffs(2,3,nfcn(3),3)+1
           ioffs(5,3,nfcn(3),3)=1
           ioffss(nfcn(3),3)=nfcns(3)                                   3d13s20
           nfcns(3)=nfcns(3)+1                                          3d13s20
           nfcn(3)=nfcn(3)+1                                                      3d12s20
           ioffs(iab,ixyz,nfcn(3),3)=1                                                3d12s20
           ioffs(icd,jxyz,nfcn(3),3)=1                                                3d12s20
           ioffs(1,1,nfcn(3),3)=ioffs(1,1,nfcn(3),3)+1
           ioffs(5,1,nfcn(3),3)=1
           ioffss(nfcn(3),3)=nfcns(3)                                   3d13s20
           nfcn(3)=nfcn(3)+1                                                      3d12s20
           ioffs(iab,ixyz,nfcn(3),3)=1                                                3d12s20
           ioffs(icd,jxyz,nfcn(3),3)=1                                                3d12s20
           ioffs(2,1,nfcn(3),3)=ioffs(2,1,nfcn(3),3)+1
           ioffs(5,1,nfcn(3),3)=1
           ioffss(nfcn(3),3)=nfcns(3)                                   3d13s20
           nfcns(3)=nfcns(3)+1                                          3d13s20
           nfcn(3)=nfcn(3)+1                                                      3d12s20
           ioffs(iab,ixyz,nfcn(3),3)=1                                                3d12s20
           ioffs(icd,jxyz,nfcn(3),3)=1                                                3d12s20
           ioffs(1,2,nfcn(3),3)=ioffs(1,2,nfcn(3),3)+1                              3d13s20
           ioffs(5,2,nfcn(3),3)=1
           ioffss(nfcn(3),3)=nfcns(3)                                   3d13s20
           nfcn(3)=nfcn(3)+1                                                      3d12s20
           ioffs(iab,ixyz,nfcn(3),3)=1                                       3d13s20
           ioffs(icd,jxyz,nfcn(3),3)=1                                                3d12s20
           ioffs(2,2,nfcn(3),3)=ioffs(2,2,nfcn(3),3)+1
           ioffs(5,2,nfcn(3),3)=1
           ioffss(nfcn(3),3)=nfcns(3)                                   3d13s20
           nfcns(3)=nfcns(3)+1                                          3d13s20
           nfcn(3)=nfcn(3)+1                                                      3d12s20
           ioffs(iab,ixyz,nfcn(3),3)=1                                                3d12s20
           ioffs(icd,jxyz,nfcn(3),3)=1                                                3d12s20
           ioffs(1,1,nfcn(3),3)=ioffs(1,1,nfcn(3),3)+1
           ioffs(5,3,nfcn(3),3)=1
           ioffss(nfcn(3),3)=nfcns(3)                                   3d13s20
           nfcn(3)=nfcn(3)+1                                                      3d12s20
           ioffs(iab,ixyz,nfcn(3),3)=1                                                3d12s20
           ioffs(icd,jxyz,nfcn(3),3)=1                                                3d12s20
           ioffs(2,1,nfcn(3),3)=ioffs(2,1,nfcn(3),3)+1
           ioffs(5,3,nfcn(3),3)=1
           ioffss(nfcn(3),3)=nfcns(3)                                   3d13s20
           nfcns(3)=nfcns(3)+1                                          3d13s20
           nfcn(3)=nfcn(3)+1                                                      3d12s20
           ioffs(iab,ixyz,nfcn(3),3)=1                                                3d12s20
           ioffs(icd,jxyz,nfcn(3),3)=1                                                3d12s20
           ioffs(1,2,nfcn(3),3)=ioffs(1,2,nfcn(3),3)+1
           ioffs(5,3,nfcn(3),3)=1
           ioffss(nfcn(3),3)=nfcns(3)                                   3d13s20
           nfcn(3)=nfcn(3)+1                                                      3d12s20
           ioffs(iab,ixyz,nfcn(3),3)=1                                                3d12s20
           ioffs(icd,jxyz,nfcn(3),3)=1                                                3d12s20
           ioffs(2,2,nfcn(3),3)=ioffs(2,2,nfcn(3),3)+1
           ioffs(5,3,nfcn(3),3)=1
           ioffss(nfcn(3),3)=nfcns(3)                                   3d13s20
           nfcns(3)=nfcns(3)+1                                          3d13s20
           nfcn(3)=nfcn(3)+1                                                      3d12s20
           ioffs(iab,ixyz,nfcn(3),3)=1                                                3d12s20
           ioffs(icd,jxyz,nfcn(3),3)=1                                                3d12s20
           ioffs(1,1,nfcn(3),3)=ioffs(1,1,nfcn(3),3)+1
           ioffs(5,2,nfcn(3),3)=1
           ioffss(nfcn(3),3)=nfcns(3)                                   3d13s20
           nfcn(3)=nfcn(3)+1                                                      3d12s20
           ioffs(iab,ixyz,nfcn(3),3)=1                                                3d12s20
           ioffs(icd,jxyz,nfcn(3),3)=1                                                3d12s20
           ioffs(2,1,nfcn(3),3)=ioffs(2,1,nfcn(3),3)+1
           ioffs(5,2,nfcn(3),3)=1
           ioffss(nfcn(3),3)=nfcns(3)                                   3d13s20
           nfcns(3)=nfcns(3)+1                                          3d13s20
          end do
         end do
        end do                                                          3d13s20
       end do                                                           3d13s20
       ifirst=1                                                         3d12s20
       do icq=1,6                                                       12d28s21
        do ifcn=1,nfcn(icq)                                             12d28s21
         cfcn(ifcn,icq)=1d0                                             12d28s21
        end do                                                          12d28s21
       end do                                                           12d28s21
       do icq=2,3
        if(icq.eq.2)then                                                9d21s21
         jtop=4
        else                                                            9d21s21
         jtop=5
        end if                                                          9d21s21
        do ifcn=1,nfcn(icq)
         cfcn(ifcn,icq)=1d0                                             12d20s20
 1848    format(i5,i4,5(5x,3i3),f10.5)
 1849    format(i5,i4,f5.0,6(5x,3i3))
        end do
       end do
       idad(1)=1                                                        3d13s20
       idad(2)=1                                                        3d13s20
       idad(3)=2                                                        3d13s20
       idad(4)=1                                                        3d13s20
       idad(5)=0                                                        3d18s20
       idad(6)=1                                                        3d18s20
       idcd(1)=1                                                        3d18s20
       idcd(2)=1                                                        3d18s20
       idcd(3)=1                                                        3d18s20
       idcd(4)=1                                                        3d18s20
       idcd(5)=1                                                        3d18s20
       idcd(6)=0                                                        3d18s20
       ibdo(1)=1                                                        3d13s20
       ibdo(2)=1                                                        3d13s20
       ibdo(3)=2                                                        3d13s20
       ibdo(4)=1                                                        3d13s20
       ibdo(5)=1                                                        3d18s20
       ibdo(6)=1                                                        3d18s20
       idad(7)=1
       idcd(7)=1
       ibdo(7)=1
       nfcn(7)=0                                                        9d21s21
       nfcns(7)=0                                                       9d21s21
       jfcn=0                                                           9d21s21
       do ifcn=1,nfcn(2)                                                9d21s21
        do i=1,3                                                        9d21s21
         ilxyz(i)=0                                                     9d21s21
        end do                                                          9d21s21
        do j=1,4                                                        9d21s21
         do i=1,3                                                       9d21s21
          ilxyz(i)=ilxyz(i)+ioffs(j,i,ifcn,2)                           9d21s21
         end do                                                         9d21s21
        end do                                                          9d21s21
        if(ilxyz(1).ne.0.and.ilxyz(2).ne.0)then                         9d21s21
         jfcn=jfcn+1                                                    9d21s21
         cfcn(jfcn,7)=1d0                                               12d20s20
         do j=1,5                                                       9d21s21
          do i=1,3                                                      9d21s21
           ioffs(j,i,jfcn,7)=ioffs(j,i,ifcn,2)                          9d21s21
          end do                                                        9d21s21
         end do                                                         9d21s21
         ioffss(jfcn,7)=jfcn-1                                          9d21s21
        else if(ilxyz(1).ne.0.and.ilxyz(3).ne.0)then                    9d21s21
         jfcn=jfcn+1                                                    9d21s21
         do j=1,5                                                       9d21s21
          do i=1,3                                                      9d21s21
           ioffs(j,i,jfcn,7)=ioffs(j,i,ifcn,2)                          9d21s21
          end do                                                        9d21s21
         end do                                                         9d21s21
         cfcn(jfcn,7)=1d0                                               12d20s20
         ioffss(jfcn,7)=jfcn-1                                          9d21s21
        else if(ilxyz(2).ne.0.and.ilxyz(3).ne.0)then                    9d21s21
         jfcn=jfcn+1                                                    9d21s21
         do j=1,5                                                       9d21s21
          do i=1,3                                                      9d21s21
           ioffs(j,i,jfcn,7)=ioffs(j,i,ifcn,2)                          9d21s21
          end do                                                        9d21s21
         end do                                                         9d21s21
         ioffss(jfcn,7)=jfcn-1                                          9d21s21
         cfcn(jfcn,7)=1d0                                               12d20s20
        end if                                                          9d21s21
       end do                                                           9d21s21
       nfcn(7)=jfcn                                                     9d21s21
       nfcns(7)=jfcn                                                    9d21s21
       do jj=1,jfcn                                                      9d22s21
        do j=1,5                                                        9d22s21
         do i=1,3                                                       9d22s21
          ioffs(j,i,jj,8)=ioffs(j,i,jj,7)                               9d22s21
          ioffs(j,i,jj,11)=ioffs(j,i,jj,7)                              9d22s21
         end do                                                         9d22s21
        end do                                                          9d22s21
        ioffss(jj,8)=ioffss(jj,7)                                       9d22s21
        ioffss(jj,11)=ioffss(jj,7)                                      9d22s21
        cfcn(jj,8)=1d0                                                  12d20s20
        cfcn(jj,11)=1d0                                                 12d20s20
       end do                                                           9d22s21
       nfcn(8)=jfcn                                                     9d22s21
       nfcns(8)=jfcn                                                    9d22s21
       nfcn(11)=jfcn                                                     9d22s21
       nfcns(11)=jfcn                                                    9d22s21
       idad(8)=1
       idcd(8)=1
       ibdo(8)=1
       idad(9)=1
       idcd(9)=1
       ibdo(9)=1
       idad(10)=idad(3)                                                 9d21s21
       idcd(10)=idcd(3)                                                 9d21s21
       ibdo(10)=ibdo(3)                                                 9d21s21
       idad(11)=idad(3)                                                 9d21s21
       idcd(11)=idcd(3)                                                 9d21s21
       ibdo(11)=ibdo(3)                                                 9d21s21
       jfcncb=jfcn
       jfcn1=0                                                          9d21s21
       jfcnb=0                                                          9d21s21
       do ifcn=1,nfcn(3)                                                9d21s21
        jfcncb=jfcncb+1                                                 9d22s21
        cfcn(jfcncb,11)=1                                               1d31s22
        do j=1,5                                                        9d22s21
         do i=1,3                                                       9d22s21
          ioffs(j,i,jfcncb,11)=ioffs(j,i,ifcn,3)                        9d22s21
         end do                                                         9d22s21
        end do                                                          9d22s21
        ioffss(jfcncb,11)=ioffss(ifcn,3)+nfcns(7)
        ilxyz(4)=0                                                      9d21s21
        do i=1,3                                                        9d21s21
         ilxyz(4)=ilxyz(4)+ioffs(5,i,ifcn,3)                            9d21s21
         ilxyz(i)=0                                                     9d21s21
        end do                                                          9d21s21
        do j=1,4                                                        9d21s21
         do i=1,3                                                       9d21s21
          ilxyz(i)=ilxyz(i)+ioffs(j,i,ifcn,3)                           9d21s21
         end do                                                         9d21s21
        end do                                                          9d21s21
        do i=1,3                                                        9d21s21
         ilxyzb(i)=ilxyz(i)+ioffs(5,i,ifcn,3)                           9d21s21
         if(ilxyzb(i).ge.2)ilxyzb(i)=ilxyzb(i)-2                        9d21s21
        end do                                                          9d21s21
 1889   format(i5,5x,3i2,5x,i2,5x,3i2)
        if(ilxyz(4).eq.0)then                                           9d21s21
         if(ilxyz(1).ne.0.and.ilxyz(2).ne.0)then                         9d21s21
          jfcn=jfcn+1                                                    9d21s21
          do j=1,5                                                       9d21s21
           do i=1,3                                                      9d21s21
            ioffs(j,i,jfcn,8)=ioffs(j,i,ifcn,3)                          9d21s21
           end do                                                        9d21s21
          end do                                                         9d21s21
          ioffss(jfcn,8)=jfcn-1                                         9d21s21
          cfcn(jfcn,8)=1d0                                              12d20s20
         else if(ilxyz(1).ne.0.and.ilxyz(3).ne.0)then                    9d21s21
          jfcn=jfcn+1                                                    9d21s21
          do j=1,5                                                       9d21s21
           do i=1,3                                                      9d21s21
            ioffs(j,i,jfcn,8)=ioffs(j,i,ifcn,3)                          9d21s21
           end do                                                        9d21s21
          end do                                                         9d21s21
          ioffss(jfcn,8)=jfcn-1                                           9d21s21
          cfcn(jfcn,8)=1d0                                              12d20s20
         else if(ilxyz(2).ne.0.and.ilxyz(3).ne.0)then                    9d21s21
          jfcn=jfcn+1                                                    9d21s21
          do j=1,5                                                       9d21s21
           do i=1,3                                                      9d21s21
            ioffs(j,i,jfcn,8)=ioffs(j,i,ifcn,3)                          9d21s21
           end do                                                        9d21s21
          end do                                                         9d21s21
          ioffss(jfcn,8)=jfcn-1                                           9d21s21
          cfcn(jfcn,8)=1d0                                              12d20s20
         else                                                           9d21s21
          jfcn=jfcn+1                                                    9d21s21
          jfcn1=jfcn1+1                                                 9d21s21
          jfcnb=jfcnb+1                                                 9d21s21
          do j=1,5                                                       9d21s21
           do i=1,3                                                      9d21s21
            ioffs(j,i,jfcn,8)=ioffs(j,i,ifcn,3)                          9d21s21
            ioffs(j,i,jfcn1,9)=ioffs(j,i,ifcn,3)                          9d21s21
            ioffs(j,i,jfcn1,10)=ioffs(j,i,ifcn,3)                          9d21s21
           end do                                                        9d21s21
          end do                                                         9d21s21
          ioffss(jfcn,8)=jfcn-1                                           9d21s21
          ioffss(jfcn1,9)=jfcn1-1                                       9d21s21
          ioffss(jfcnb,10)=ioffss(ifcn,3)                               9d21s21
          cfcn(jfcn,8)=1d0                                              12d20s20
          cfcn(jfcn1,9)=1d0                                              12d20s20
          cfcn(jfcnb,10)=1d0                                              12d20s20
         end if                                                         9d21s21
        else                                                            9d21s21
         if(ilxyzb(1).ne.0.and.ilxyzb(2).ne.0)then                        9d21s21
         else if(ilxyzb(1).ne.0.and.ilxyzb(3).ne.0)then                        9d21s21
         else if(ilxyzb(2).ne.0.and.ilxyzb(3).ne.0)then                        9d21s21
         else                                                           9d21s21
          jfcnb=jfcnb+1                                                 9d21s21
          do j=1,5                                                       9d21s21
           do i=1,3                                                      9d21s21
            ioffs(j,i,jfcnb,10)=ioffs(j,i,ifcn,3)                          9d21s21
           end do                                                        9d21s21
          end do                                                         9d21s21
          ioffss(jfcnb,10)=ioffss(ifcn,3)                               9d21s21
          cfcn(jfcnb,10)=1d0                                            12d20s20
         end if                                                         9d21s21
        end if                                                          9d21s21
       end do                                                           9d21s21
       nfcn(8)=jfcn                                                     9d21s21
       nfcns(8)=jfcn                                                    9d21s21
       nfcn(9)=jfcn1                                                     9d21s21
       nfcns(9)=jfcn1                                                   9d21s21
       nfcn(10)=jfcnb                                                   9d21s21
       nfcn(11)=jfcncb                                                  9d22s21
       nfcns(11)=nfcns(7)+nfcns(3)                                      9d22s21
       do icq=7,11
        if(icq.eq.7)then                                                9d21s21
         jtop=4
        else if(icq.eq.8)then                                                            9d21s21
         jtop=5
        else if(icq.eq.9)then                                           9d21s21
         jtop=5
        else if(icq.eq.10)then                                          9d22s21
         ii=0                                                           9d21s21
         last=ioffss(1,10)                                              9d21s21
         do ifcn=1,nfcn(icq)                                            9d21s21
          if(ioffss(ifcn,10).ne.last)then                               9d21s21
           last=ioffss(ifcn,10)                                         9d21s21
           ii=ii+1                                                      9d21s21
          end if                                                        9d21s21
          ioffss(ifcn,10)=ii                                            9d21s21
         end do                                                         9d21s21
         jtop=5
        else                                                            9d22s21
         jtop=5                                                         9d22s21
        end if                                                          9d21s21
       end do
       nfcns(10)=ii                                                     9d21s21
       icq=12                                                           12d20s20
       do itype=1,3                                                     12d20s20
        itypep=itype+1
        nfcns(icq)=4                                                    12d20s20
        nfcn(icq)=4                                                     12d29s21
        idad(icq)=1                                                       12d20s20
        idcd(icq)=1                                                       12d20s20
        ibdo(icq)=1                                                       12d20s20
        do i=1,4                                                        12d20s20
         im=i-1                                                         12d20s20
         ioffss(i,icq)=(im/2)                                           12d20s20
         if(mod(im,2).eq.0)then                                         12d20s20
          cfcn(i,icq)=1d0                                               12d20s20
         else                                                           12d20s20
          cfcn(i,icq)=-1d0                                              12d20s20
         end if                                                         12d20s20
         do j=1,4                                                       12d20s20
          iu=icoul(i,j,itype)+1                                         12d20s20
          do k=1,3                                                      12d20s20
           ioffs(j,k,i,icq)=nxyz(k,iu)                                  12d20s20
          end do                                                        12d20s20
         end do                                                         12d20s20
         do k=1,3                                                       12d20s20
          ioffs(5,k,i,icq)=0                                            12d20s20
         end do                                                         12d20s20
        end do                                                          12d20s20
        nfcns(icq)=2                                                    12d29s21
        icq=icq+1                                                       12d20s20
       end do                                                           12d20s20
       do itype=1,4                                                     12d20s20
        idad(icq)=1                                                       12d20s20
        idcd(icq)=1                                                       12d20s20
        ibdo(icq)=1                                                       12d20s20
        if(itype.eq.1)then                                              12d20s20
         nfcns(icq)=0                                                   12d20s20
         n0=0                                                           12d20s20
        else                                                            12d20s20
         nfcns(icq)=4                                                    12d20s20
         itypem=itype-1                                                 12d20s20
         n0=2                                                           12d20s20
         do i=1,4                                                        12d20s20
          im=i-1                                                         12d20s20
          ioffss(i,icq)=(im/2)                                           12d20s20
          if(mod(im,2).eq.0)then                                         12d20s20
           cfcn(i,icq)=1d0                                               12d20s20
          else                                                           12d20s20
           cfcn(i,icq)=-1d0                                              12d20s20
          end if                                                         12d20s20
          do j=1,4                                                       12d20s20
           iu=icoul(i,j,itypem)+1                                       12d20s20
           do k=1,3                                                      12d20s20
            ioffs(j,k,i,icq)=nxyz(k,iu)                                  12d20s20
           end do                                                        12d20s20
          end do                                                         12d20s20
          do k=1,3                                                      12d20s20
           ioffs(5,k,i,icq)=0                                           12d20s20
          end do                                                        12d20s20
         end do                                                          12d20s20
        end if                                                          12d20s20
        do i=1,ngaunt(itype)
         nfcns(icq)=nfcns(icq)+1                                        12d20s20
         ioffss(nfcns(icq),icq)=n0                                      12d20s20
         n0=n0+1                                                        12d20s20
         cfcn(nfcns(icq),icq)=gaunt(i,itype)                            1d24s22
         do j=1,4                                                       12d20s20
          iu=igaunt(i,j,itype)+1                                        12d20s20
          do k=1,3                                                      12d20s20
           ioffs(j,k,nfcns(icq),icq)=nxyz(k,iu)                         12d20s20
          end do                                                        12d20s20
          do k=1,3                                                      12d20s20
           ioffs(5,k,i,icq)=0                                           12d20s20
          end do                                                        12d20s20
         end do                                                         12d20s20
        end do                                                          12d20s20
        nfcn(icq)=nfcns(icq)                                            12d29s21
        nfcns(icq)=ioffss(nfcns(icq),icq)+1                             12d29s21
        icq=icq+1                                                       12d20s20
       end do                                                           12d20s20
       do itype=1,4                                                     12d20s20
        idad(icq)=2                                                       12d20s20
        idcd(icq)=1                                                       12d20s20
        ibdo(icq)=2                                                       12d20s20
        if(itype.eq.1)then                                              12d20s20
         nfcns(icq)=0                                                   12d20s20
         n0=0                                                           12d20s20
        else                                                            12d20s20
         nfcns(icq)=4                                                    12d20s20
         itypem=itype-1                                                 12d20s20
         n0=2                                                           12d20s20
         do i=1,4                                                        12d20s20
          im=i-1                                                         12d20s20
          ioffss(i,icq)=(im/2)                                           12d20s20
          if(mod(im,2).eq.0)then                                         12d20s20
           cfcn(i,icq)=1d0                                               12d20s20
          else                                                           12d20s20
           cfcn(i,icq)=-1d0                                              12d20s20
          end if                                                         12d20s20
          do j=1,4                                                       12d20s20
           iu=icoul(i,j,itypem)+1                                       12d20s20
           do k=1,3                                                      12d20s20
            ioffs(j,k,i,icq)=nxyz(k,iu)                                  12d20s20
           end do                                                        12d20s20
          end do                                                         12d20s20
          do k=1,3                                                      12d20s20
           ioffs(5,k,i,icq)=0                                           12d20s20
          end do                                                        12d20s20
         end do                                                          12d20s20
        end if                                                          12d20s20
        do i=1,ngaunt(itype)
         nfcns(icq)=nfcns(icq)+1                                        12d20s20
         ioffss(nfcns(icq),icq)=n0                                      12d20s20
         n0=n0+1                                                        12d20s20
         cfcn(nfcns(icq),icq)=gaunt(i,itype)                            1d24s22
         do j=1,4                                                       12d20s20
          iu=igaunt(i,j,itype)+1                                        12d20s20
          do k=1,3                                                      12d20s20
           ioffs(j,k,nfcns(icq),icq)=nxyz(k,iu)                         12d20s20
          end do                                                        12d20s20
          do k=1,3                                                      12d20s20
           ioffs(5,k,i,icq)=0                                           12d20s20
          end do                                                        12d20s20
         end do                                                         12d20s20
        end do                                                          12d20s20
        n0=n0-1                                                         12d20s20
        do i=1,nbreit(itype)                                            12d20s20
         nfcns(icq)=nfcns(icq)+1                                        12d20s20
         ioffss(nfcns(icq),icq)=n0+ibreit(i,6,itype)                    12d20s20
         cfcn(nfcns(icq),icq)=xbreit(i,itype)                           12d20s20
         do j=1,5                                                       12d20s20
          iu=ibreit(i,j,itype)+1                                        12d20s20
          do k=1,3                                                      12d20s20
           ioffs(j,k,nfcns(icq),icq)=nxyz(k,iu)                         12d20s20
          end do                                                        12d20s20
         end do                                                         12d20s20
        end do                                                          12d20s20
        nfcn(icq)=nfcns(icq)                                            12d29s21
        nfcns(icq)=ioffss(nfcns(icq),icq)+1                             12d29s21
        icq=icq+1                                                       12d20s20
       end do                                                           12d20s20
      end if                                                            3d13s20
      nxd=idad(icode)+1                                                 3d16s20
   50 nyd=idcd(icode)+1                                                 3d18s20
      nxd2m=nxd*nxd-1                                                   3d16s20
      ldeb=ldebp                                                        2d26s20
 1066 continue                                                          2d26s20
      if(ldeb)
     $     write(6,1)la,zza,xa,ya,za,lb,zzb,xb,yb,zb,lc,zzc,xc,yc,zc,        1d29s10
     $     ld,zzd,xd,yd,zd                                              1d29s10
      if(ldeb)write(6,335)iax,iay,iaz,ibx,iby,ibz,icx,icy,icz,idx,
     $     idy,
     $     idz
  335 format(4(3i1,3x))
      nex=0
      nexgh=0
      nexgh=nexgh+1                                                     3d12s20
    1 format('in dgerid: ',4(i3,1pe15.7,0p3f8.4))                          1d29s10
      ltmp(1)=la+1                                                      1d13s10
      ltmp(2)=lb+1                                                      1d13s10
      ltmp(3)=lc+1                                                      1d13s10
      ltmp(4)=ld+1                                                      1d13s10
      do i=1,4                                                          1d13s10
       koff=-1                                                          1d14s10
       do isym=1,8                                                      1d13s10
        joff(isym,i)=koff                                               1d14s10
        nhere(isym,i)=0                                                 1d13s10
        mhere(isym,i)=0                                                 1d14s10
        if(ipt(isym,ltmp(i)).gt.0)then                                  1d13s10
         isto=ipt(isym,ltmp(i))                                         1d13s10
         nhere(isym,i)=ibc(isto)                                        1d13s10
         mhere(isym,i)=ibc(isto+1)                                      1d13s10
         icoef(isym,i)=isto+2+mhere(isym,i)+3*nhere(isym,i)             1d13s10
         ipowb=isto+2+ibc(isto+1)                                       1d13s10
         koff=koff+mhere(isym,i)                                        1d14s10
        end if                                                          1d13s10
       end do                                                           1d13s10
      end do                                                            1d13s10
      if(ibdo(icode).gt.1)then                                          3d13s20
       iadd=3+lc+ld+nexgh                                                     7d13s15
      else                                                              7d13s15
       iadd=2+lc+ld                                                     7d13s15
      end if                                                            7d13s15
      nq1=(la+lb+iadd
     $      +max(iax+idad(icode),iay+idad(icode),iaz+idad(icode))
     $      +max(ibx,iby,ibz)+idad(icode)                               3d13s20
     $     +max(icx+idcd(icode),icy+idcd(icode),icz+idcd(icode))        3d18s20
     $     +max(idx+idcd(icode),idy+idcd(icode),idz+idcd(icode)))/2     3d18s20
      nq1=nq1+nex
      nq1=nq1+iadd1                                                     7d14s15
      nq2=(iadd+max(icx+idcd(icode),icy+idcd(icode),icz+idcd(icode))    3d18s20
     $     +max(idx+idcd(icode),idy+idcd(icode),idz+idcd(icode)))/2     3d18s20
      nq2=nq2+nex
      nq2=nq2+iadd2                                                     7d14s15
      lap=la+1                                                          1d13s10
      lbp=lb+1                                                          1d13s10
      lcp=lc+1                                                          1d13s10
      ldp=ld+1                                                          1d13s10
      ncarti=ibc(ipp(lap))*ibc(ipp(lbp))*ibc(ipp(lcp))*ibc(ipp(ldp))    1d14s10
      icartt=ibcoff                                                     1d14s10
      ibcoff=icartt+ncarti*nfcn(icode)                                  3d13s20
      inode1=ibcoff
      iwgt1=inode1+nq1
      itmp=iwgt1+nq1
      ibcoff=itmp+nq1
      if(ibcoff-ioffsx.gt.maxbc)write(6,*)('enough no. 1'),inode1,nq1,  11d2s22
     $     nex,iadd,                                                    11d2s22
     $     la,lb,iax,iay,iaz,ibx,iby,ibz,icx,icy,icz,idx,idy,idz
      call enough('dgerid.  1',bc,ibc)
      iad1=(nq1*(nq1-1))+ibcgh                                          1d26s23
      iad2=iad1+nq1                                                     1d26s23
      jnode1=iad2-1                                                     1d26s23
      jwgt1=iad1-1                                                      1d26s23
      ibcoff=itmp
      inode2=ibcoff
      iwgt2=inode2+nq2
      itmp=iwgt2+nq2
      ibcoff=itmp+nq2
      if(ibcoff-ioffsx.gt.maxbc)write(6,*)('enough no. 2')              11d2s22
      call enough('dgerid.  2',bc,ibc)
      ibcoff=itmp
      iad1=(nq2*(nq2-1))+ibcgh                                          1d26s23
      iad2=iad1+nq2                                                     1d26s23
      jnode2=iad2-1                                                     1d26s23
      jwgt2=iad1-1                                                      1d26s23
      irnode=ibcoff                                                     1d7s09
      iabderadd=idad(icode)                                             3d18s20
      if(icode.ne.3)iabderadd=iabderadd*2                               3d18s20
      icdderadd=idcd(icode)                                             3d18s20
      if(icode.ne.3)icdderadd=icdderadd*2                               3d18s20
      iadd=iadd+iax+iay+iaz+ibx+iby+ibz+icx+icy+icz+idx+idy+idz
     $     +iabderadd+icdderadd                                         3d18s20
      nqr=(la+lb+iadd)/2                                                7d13s15
      nqr=nqr+nex
      nqr=nqr+iadd3                                                     7d14s15
      if(ldeb)write(6,*)('nq1 etc '),nq1,nq2,nqr                                  3d16s20
      irwgt=irnode+nqr                                                   1d7s09
      ibcoff=irwgt+nqr                                                   1d12s10
      if(ibcoff-ioffsx.gt.maxbc)write(6,*)('enough no. 3')              11d2s22
      call enough('dgerid.  3',bc,ibc)
      zzab=zza+zzb                                                         1d13s10
      zzcd=zzc+zzd                                                         1d13s10
      zzabcd=zzab+zzcd
      pref=(zza*zzb*((xa-xb)**2+(ya-yb)**2+(za-zb)**2)/zzab)            1d29s10
     $     +(zzc*zzd*((xc-xd)**2+(yc-yd)**2+(zc-zd)**2)/zzcd)            1d29s10
      pref0=pref                                                        4d21s16
      pref=exp(-pref)                                                   1d22s10
      if(pref.ne.pref)then
       write(6,*)('pref is nan '),pref0
       write(6,1)la,zza,xa,ya,za,lb,zzb,xb,yb,zb,lc,zzc,xc,yc,zc,        1d29s10
     $      ld,zzd,xd,yd,zd                                              1d29s10
       write(6,335)iax,iay,iaz,ibx,iby,ibz,icx,icy,icz,idx,idy,
     $     idz
      call dws_sync
            call dws_finalize
       stop
      end if
      xab=zza*xa+zzb*xb
      yab=zza*ya+zzb*yb
      zab=zza*za+zzb*zb
      xcd=zzc*xc+zzd*xd
      ycd=zzc*yc+zzd*yd
      zcd=zzc*zc+zzd*zd
      xabcd=xab+xcd
      yabcd=yab+ycd
      zabcd=zab+zcd
      bigx=((zzcd*xab-zzab*xcd)**2+(zzcd*yab-zzab*ycd)**2
     $     +(zzcd*zab-zzab*zcd)**2)/(zzab*zzcd*zzabcd)                  1d29s10
      if(nqr.ge.nqx)then                                                6d22s12
       write(6,*)('asking for more rys quadrature points than are '),   6d22s12
     $     ('available '),nqr,nqx                                       6d22s12
      end if                                                            6d22s12
      iaddq=ibc(ibcrys+2*(nqr-1))                                       6d22s12
      nreg=ibc(ibcrys+1+2*(nqr-1))                                      6d22s12
      ratio=bigx/bc(iaddq)                                              10d29s15
      if(ratio.le.nreg+1)then                                           10d29s15
       ireg=int(ratio)                                                  10d29s15
      else                                                              10d29s15
       ireg=nreg+1                                                      10d29s15
      end if                                                            10d29s15
      ireg=ireg+1                                                       6d22s12
      if(ireg.le.nreg)then                                              6d22s12
       a=dfloat(ireg-1)*bc(iaddq)                                       6d22s12
       b=a+bc(iaddq)                                                    6d22s12
       y=(2d0*bigx-a-b)/bc(iaddq)                                       6d22s12
       y2=2d0*y                                                         6d22s12
       try=bc(iaddq+2*nqr+ireg)                                         6d22s12
       itry=nint(try)                                                   6d22s12
       itry=itry+ibc(ibcrys)-1
       do i=1,nqr                                                       6d22s12
        ncoef=nint(bc(itry))                                            6d22s12
        itry=itry+1                                                     6d22s12
        dw=0d0                                                          6d22s12
        ddw=0d0                                                         6d22s12
        dn=0d0                                                          6d22s12
        ddn=0d0                                                         6d22s12
        j1=itry                                                         6d25s12
        do j=ncoef,2,-1                                                 6d22s12
         j2=j1+1                                                        6d22s12
         svw=dw                                                         6d22s12
         svn=dn                                                         6d22s12
         dw=y2*dw-ddw+bc(j1)                                            6d22s12
         dn=y2*dn-ddn+bc(j2)                                            6d22s12
         ddw=svw                                                        6d22s12
         ddn=svn                                                        6d22s12
         j1=j2+1                                                        6d25s12
        end do                                                          6d22s12
        j2=j1+1                                                         6d25s12
        wgt=y*dw-ddw+0.5d0*bc(j1)                                       6d25s12
        xnod=y*dn-ddn+0.5d0*bc(j2)                                       6d25s12
        itry=itry+2*ncoef                                               6d22s12
        bc(irwgt+i-1)=wgt                                               7d5s12
        bc(irnode+i-1)=xnod                                              7d5s12
       end do                                                           6d22s12
      else                                                              6d22s12
       j1=iaddq+1                                                       6d25s12
       argi=1d0/sqrt(bigx)
       do i=1,nqr
        ghw=bc(j1)
        wgt=ghw*argi
        j1=j1+1
        ghx=bc(j1)
        j1=j1+1
        r2=ghx**2
        trial=r2/(bigx-r2)
        bc(irwgt+i-1)=wgt                                               7d5s12
        bc(irnode+i-1)=trial                                            7d5s12
       end do
      end if                                                            6d22s12
      jrnode=irnode-1                                                   1d11s10
      jrwgt=irwgt-1                                                     1d11s10
      pi=acos(-1d0)                                                     1d11s10
      front0=pref*2d0/sqrt(pi)                                          3d12s20
      if(front0.ne.front0)then
       write(6,*)('front0 nan: '),pref,pi
      end if
      bsia=0.5d0/zza                                                     1d13s10
      bsib=0.5d0/zzb                                                     1d13s10
      bsic=0.5d0/zzc                                                     1d13s10
      bsid=0.5d0/zzd                                                     1d13s10
      rho=sqrt(zzab*zzcd/zzabcd)                                           1d13s10
      dnorm=xna*xnb*xnc*xnd                                             1d13s10
      front=dnorm*front0*rho/sqrt((zzab*zzcd)**3)                         1d13s10
      if(front.ne.front)then
       write(6,*)('starting front nan!!! '),dnorm,front0,rho,zzab,zzcd
       write(6,*)('dgerid ')
            call dws_sync
            call dws_finalize
       stop
      end if
      iader=iax+iay+iaz                                                 9d8s10
      zza2=zza*2d0                                                      9d8s10
      if(iader.gt.0)front=front*(zza2**iader)                           9d8s10
      ibder=ibx+iby+ibz                                                 9d8s10
      zzb2=zzb*2d0                                                      9d8s10
      if(ibder.gt.0)front=front*(zzb2**ibder)                           9d8s10
      icder=icx+icy+icz                                                 9d8s10
      zzc2=zzc*2d0                                                      9d8s10
      if(icder.gt.0)front=front*(zzc2**icder)                           9d8s10
      idder=idx+idy+idz                                                 9d8s10
      zzd2=zzd*2d0                                                      9d8s10
      if(idder.gt.0)front=front*(zzd2**idder)                           9d8s10
      if(front.ne.front)then
       write(6,*)('ending front nan!!! '),zza2,zzb2,zzc3,zzd2,iader,
     $      ibder,icder,idder
            call dws_sync
            call dws_finalize
       stop
      end if
      icartab=ibcoff                                                    1d13s10
      kcartab=icartab-1                                                 1d13s10
      nwdsab=lap*lbp                                                    7d6s15
      nwdsab3=nwdsab*3                                                  1d29s10
      nwdsabc=nwdsab*lcp                                                7d6s15
      nwdsab9=nwdsab*9                                                  3d12s20
      icartaby=icartab+nwdsab9                                          3d12s20
      icartabz=icartaby+nwdsab9                                         3d12s20
      ibcoff=icartabz+nwdsab9                                           3d13s20
      kcartaby=icartaby-1                                               1d29s10
      kcartabz=icartabz-1                                               1d29s10
      icartabcd=ibcoff                                                    1d13s10
      nwdscd=lcp*ldp                                                    7d6s15
      nwdscd4=nwdscd*nyd*nyd                                            3d18s20
      nwdsabcd=nwdsab9*nwdscd4*ibdo(icode)                              3d18s20
      nwdsabcd3=nwdsabcd*3                                              3d13s20
      ibcoff=icartabcd+nwdsabcd3                                        1d29s10
      icartabcdy=icartabcd+nwdsabcd                                     1d29s10
      icartabcdz=icartabcdy+nwdsabcd                                    1d29s10
      ifcna=ibcoff                                                      1d13s10
      ifcnb=ifcna+max(2,lap+max(iax+idad(icode),iay+idad(icode),        3d18s20
     $     iaz+idad(icode)))                                            3d18s20
      ifcnc=ifcnb+max(2,lbp+max(ibx+idad(icode),iby+idad(icode),        3d18s20
     $     ibz+idad(icode)))                                            3d18s20
      ifcnd=ifcnc+max(2,lcp+max(icx+idcd(icode),icy+idcd(icode),        3d18s20
     $     icz+idcd(icode)))                                            3d18s20
      ibcoff=ifcnd+max(2,ldp+max(idx+idcd(icode),idy+idcd(icode),       3d18s20
     $     idz+idcd(icode)))                                            3d18s20
      icarti=ibcoff
      ibcoff=icarti+ncarti*nfcn(icode)                                  3d13s20
      if(ibcoff-ioffsx.gt.maxbc)write(6,*)('enough no. 4')              11d2s22
      call enough('dgerid.  4',bc,ibc)
      do i=icarti,ibcoff-1                                              3d12s20
       bc(i)=0d0                                                        3d12s20
      end do                                                            3d12s20
      if(ldeb)write(6,*)('front: '),front,front0,pref0,nqr,nq1,nq2      3d12s20
      do irq=1,nqr                                                      1d14s10
       use2=rho*rho*bc(jrnode+irq)                                      7d5s12
       rwgt=bc(jrwgt+irq)*front                                         1d14s10
       if(rwgt.ne.rwgt)then
        write(6,*)('rwgt is nan for irq = '),irq,('!!!')
        if(idbg.eq.0.or..not.ldeb)then                                  2d26s20
         idbg=1                                                         2d26s20
         ldeb=.true.                                                    2d26s20
         go to 1066                                                      2d26s20
        else                                                            2d26s20
         call dws_sync
         call dws_finalize
         stop
        end if                                                          2d26s20
       end if
       as1=1d0/(use2+zzcd)                                               1d14s10
       as2=use2*as1                                                      1d14s10
       ss2x=xcd*as1                                                     1d29s10
       ss2y=ycd*as1                                                     1d29s10
       ss2z=zcd*as1                                                     1d29s10
       as1=sqrt(as1)                                                    1d14s10
       t3i=1d0/(zzab*zzcd+zzabcd*use2)                                  1d29s10
       as3=sqrt((zzcd+use2)*t3i)                                        1d29s10
       ss3x=(use2*xabcd+zzcd*xab)*t3i                                   1d29s10
       ss3y=(use2*yabcd+zzcd*yab)*t3i                                   1d29s10
       ss3z=(use2*zabcd+zzcd*zab)*t3i                                   1d29s10
   55  format('rysq: ',i5,1p2e15.7)
       do i=0,nwdsabcd3-1                                               1d29s10
        bc(icartabcd+i)=0d0                                             1d14s10
       end do                                                           1d14s10
       if(ldeb)then                                                     3d16s20
        call second(time2)                                              3d16s20
        call second(time1)                                              3d16s20
        tovr=time1-time2                                                3d16s20
        tsto=0d0                                                        3d16s20
       end if                                                           3d16s20
       do iq1=1,nq1                                                     1d14s10
        arg=bc(jnode1+iq1)*as3                                          1d29s10
        arge1=arg                                                       2d12s20
        argx=arg+ss3x                                                   1d29s10
        arga=argx-xa
        argb=argx-xb
        term=bc(jwgt1+iq1)                                              1d14s10
        bc(ifcna)=1d0
        bc(ifcnb)=term
        bc(ifcna+1)=-arga                                               1d29s10
        ff=bsia
        do i=2,la+iax+idad(icode)                                       3d13s20
         bc(ifcna+i)=-arga*bc(ifcna+i-1)-ff*bc(ifcna+i-2)               2d16s10
         ff=ff+bsia
        end do
        bc(ifcnb+1)=-argb*term                                          1d29s10
        ff=bsib
        do i=2,lb+ibx+idad(icode)                                       3d13s20
         bc(ifcnb+i)=-argb*bc(ifcnb+i-1)-ff*bc(ifcnb+i-2)               2d16s10
         ff=ff+bsib
        end do
        jcartab=icartab                                                 1d14s10
        do ipb=ibx,ibx+idad(icode)                                      3d16s20
         do ipa=iax,iax+idad(icode)                                     3d16s20
          do ib=0,lb                                                      7d6s15
           do ia=0,la                                                     7d6s15
            bc(jcartab)=bc(ifcna+ia+ipa)*bc(ifcnb+ib+ipb)               3d12s20
            jcartab=jcartab+1                                             1d14s10
           end do                                                       3d12s20
          end do                                                        3d12s20
         end do                                                         1d14s10
        end do                                                          1d14s10
        argy=arg+ss3y                                                   1d29s10
        arga=argy-ya
        argb=argy-yb
        term=bc(jwgt1+iq1)                                              1d14s10
        bc(ifcna)=1d0
        bc(ifcnb)=term
        bc(ifcna+1)=-arga                                               1d29s10
        ff=bsia
        do i=2,la+iay+idad(icode)                                       3d13s20
         bc(ifcna+i)=-arga*bc(ifcna+i-1)-ff*bc(ifcna+i-2)               2d16s10
         ff=ff+bsia
        end do
        bc(ifcnb+1)=-argb*term                                          1d29s10
        ff=bsib
        do i=2,lb+iby+idad(icode)                                       3d13s20
         bc(ifcnb+i)=-argb*bc(ifcnb+i-1)-ff*bc(ifcnb+i-2)               2d16s10(
         ff=ff+bsib
        end do
        jcartab=icartaby                                                1d29s10
        do ibp=iby,iby+idad(icode)                                      3d16s20
         do iap=iay,iay+idad(icode)                                     3d16s20
          do ib=0,lb                                                      7d6s15
           do ia=0,la                                                     7d6s15
            bc(jcartab)=bc(ifcna+ia+iap)*bc(ifcnb+ib+ibp)               3d12s20
            jcartab=jcartab+1                                             1d14s10
           end do                                                         1d14s10
          end do                                                          1d14s10
         end do                                                         3d12s20
        end do                                                          3d12s20
        argz=arg+ss3z                                                   1d29s10
        arga=argz-za
        argb=argz-zb
        term=bc(jwgt1+iq1)                                              1d14s10
        bc(ifcna)=1d0
        bc(ifcnb)=term
        bc(ifcna+1)=-arga                                               1d29s10
        ff=bsia
        do i=2,la+iaz+idad(icode)                                       3d13s20
         bc(ifcna+i)=-arga*bc(ifcna+i-1)-ff*bc(ifcna+i-2)               2d16s10(
         ff=ff+bsia
        end do
        bc(ifcnb+1)=-argb*term                                          1d29s10
        ff=bsib
        do i=2,lb+ibz+idad(icode)                                       3d13s20
         bc(ifcnb+i)=-argb*bc(ifcnb+i-1)-ff*bc(ifcnb+i-2)               2d16s10(
         ff=ff+bsib
        end do
        jcartab=icartabz                                                1d29s10
        do ibp=ibz,ibz+idad(icode)                                      3d16s20
         do iap=iaz,iaz+idad(icode)                                     3d16s20
          do ib=0,lb                                                      7d6s15
           do ia=0,la                                                     7d6s15
            bc(jcartab)=bc(ifcna+ia+iap)*bc(ifcnb+ib+ibp)                 7d6s15
            jcartab=jcartab+1                                             1d14s10
           end do                                                         1d14s10
          end do                                                          1d14s10
         end do                                                         3d12s20
        end do                                                          3d12s20
c
c     i introduced the following to avoid numerical problems when doing 3d18s20
c     finite nuclei ... but it screws up breit calculations. So don't   3d18s20
c     do it!                                                            3d18s20
c
        shftx=argx*as2+ss2x                                             3d18s20
        shfty=argy*as2+ss2y                                             3d18s20
        shftz=argz*as2+ss2z                                             3d18s20
        do iq2=1,nq2                                                    1d14s10
         arg=bc(jnode2+iq2)*as1
         breit12=arge1-arg                                              2d12s20
         argx2=arg+shftx                                                7d13s15
         argc=argx2-xc                                                  7d13s15
         argd=argx2-xd                                                  7d13s15
         breit(1)=1d0
         x12=argx-argx2                                                  7d13s15
         breit(2)=x12                                                   3d25s19
         term=bc(jwgt2+iq2)
         bc(ifcnc)=1d0                                                  1d14s10
         bc(ifcnd)=term
         bc(ifcnc+1)=-argc                                              1d29s10
         ff=bsic                                                        1d14s10
         do i=2,lc+icx+idcd(icode)                                      3d18s20
          bc(ifcnc+i)=-argc*bc(ifcnc+i-1)-ff*bc(ifcnc+i-2)              2d16s10(
          ff=ff+bsic                                                    1d14s10
         end do                                                         1d14s10
         bc(ifcnd+1)=-argd*term                                         7d14s15
         ff=bsid                                                        1d14s10
         do i=2,ld+idx+idcd(icode)                                      3d18s20
          bc(ifcnd+i)=-argd*bc(ifcnd+i-1)-ff*bc(ifcnd+i-2)              2d16s10(
          ff=ff+bsid                                                    1d14s10
         end do                                                         1d14s10
         jcartabcd=icartabcd                                            1d14s10
         do ibrt=1,ibdo(icode)                                          3d13s20
          do idp=idx,idx+idcd(icode)                                    3d18s20
           do icp=icx,icx+idcd(icode)                                   3d18s20
            do lab=0,nxd2m                                              3d16s20
             lcartab=kcartab+lab*nwdsab                                 3d12s20
             do id=0,ld                                                     7d6s15
              do ic=0,lc                                                    7d6s15
               ff=bc(ifcnc+ic+icp)*bc(ifcnd+id+idp)*breit(ibrt)          3d12s20
               do iab=1,nwdsab                                          3d12s20
                bc(jcartabcd)=bc(jcartabcd)+ff*bc(lcartab+iab)              1d14s10
                jcartabcd=jcartabcd+1                                       1d14s10
               end do                                                   3d12s20
              end do                                                       1d14s10
             end do                                                     3d12s20
            end do                                                        1d14s10
           end do                                                         1d14s10
          end do                                                        3d12s20
         end do                                                         3d12s20
         argy2=arg+shfty                                                7d13s15
         y12=argy-argy2                                                  7d13s15
         breit(2)=y12                                                   3d25s19
         argc=argy2-yc                                                  7d13s15
         argd=argy2-yd                                                  7d13s15
         term=bc(jwgt2+iq2)
         bc(ifcnc)=1d0                                                  1d14s10
         bc(ifcnd)=term                                                 1d14s10
         bc(ifcnc+1)=-argc                                              1d29s10
         ff=bsic                                                        1d14s10
         do i=2,lc+icy+idcd(icode)                                      3d18s20
          bc(ifcnc+i)=-argc*bc(ifcnc+i-1)-ff*bc(ifcnc+i-2)              2d16s10
          ff=ff+bsic                                                    1d14s10
         end do                                                         1d14s10
         bc(ifcnd+1)=-argd*term                                         1d29s10
         ff=bsid                                                        1d14s10
         do i=2,ld+idy+idcd(icode)                                      3d18s20
          bc(ifcnd+i)=-argd*bc(ifcnd+i-1)-ff*bc(ifcnd+i-2)              2d16s10
          ff=ff+bsid                                                    1d14s10
         end do                                                         1d14s10
         jcartabcd=icartabcdy                                           1d29s10
         do ibrt=1,ibdo(icode)                                          3d13s20
          do idp=idy,idy+idcd(icode)                                    3d18s20
           do icp=icy,icy+idcd(icode)                                   3d18s20
            do lab=0,nxd2m                                              3d16s20
             lcartaby=kcartaby+lab*nwdsab                               3d12s20
             do id=0,ld                                                   3d12s20
              do ic=0,lc                                                  3d12s20
               ff=bc(ifcnc+ic+icp)*bc(ifcnd+id+idp)*breit(ibrt)          3d12s20
               do iab=1,nwdsab                                           3d12s20
                bc(jcartabcd)=bc(jcartabcd)+ff*bc(lcartaby+iab)          3d12s20
                jcartabcd=jcartabcd+1                                       1d14s10
               end do                                                   3d12s20
              end do                                                    3d12s20
             end do                                                       1d14s10
            end do                                                        1d14s10
           end do                                                         1d14s10
          end do                                                        3d12s20
         end do                                                         3d12s20
         argz2=arg+shftz                                                7d13s15
         z12=argz-argz2                                                  7d13s15
         breit(2)=z12                                                   3d25s19
         argc=argz2-zc                                                  7d13s15
         argd=argz2-zd                                                  7d13s15
         term=bc(jwgt2+iq2)
         bc(ifcnc)=1d0                                                  1d14s10
         bc(ifcnd)=term                                                 1d14s10
         bc(ifcnc+1)=-argc                                              1d29s10
         ff=bsic                                                        1d14s10
         do i=2,lc+icz+idcd(icode)                                      3d18s20
          bc(ifcnc+i)=-argc*bc(ifcnc+i-1)-ff*bc(ifcnc+i-2)              2d16s10
          ff=ff+bsic                                                    1d14s10
         end do                                                         1d14s10
         bc(ifcnd+1)=-argd*term                                         1d29s10
         ff=bsid                                                        1d14s10
         do i=2,ld+idz+idcd(icode)                                      3d18s20
          bc(ifcnd+i)=-argd*bc(ifcnd+i-1)-ff*bc(ifcnd+i-2)              2d16s10
          ff=ff+bsid                                                    1d14s10
         end do                                                         1d14s10
         jcartabcd=icartabcdz                                           1d29s10
         if(ldeb)then
          write(6,*)('for iq1 = '),iq1
          call prntm2(bc(icartab),lap,lbp,lap)
          call prntm2(bc(icartaby),lap,lbp,lap)
          call prntm2(bc(icartabz),lap,lbp,lap)
          write(6,*)('fcnc '),icz
          call prntm2(bc(ifcnc),1,lcp,1)
          write(6,*)('fcnd '),idz
          call prntm2(bc(ifcnd),1,ldp,1)
         end if
         do ibrt=1,ibdo(icode)                                          3d13s20
          do idp=idz,idz+idcd(icode)                                    3d18s20
           do icp=icz,icz+idcd(icode)                                   3d18s20
            do lab=0,nxd2m                                              3d16s20
             lcartabz=kcartabz+lab*nwdsab                               3d12s20
             do id=0,ld                                                     7d6s15
              do ic=0,lc                                                    7d6s15
               ff=bc(ifcnc+ic+icp)*bc(ifcnd+id+idp)*breit(ibrt)          3d12s20
               do iab=1,nwdsab                                          3d12s20
                bc(jcartabcd)=bc(jcartabcd)+ff*bc(lcartabz+iab)         3d13s20
                jcartabcd=jcartabcd+1                                       1d14s10
               end do                                                   3d12s20
              end do                                                    3d12s20
             end do                                                       1d14s10
            end do                                                        1d14s10
           end do                                                         1d14s10
          end do                                                        3d12s20
         end do                                                         3d12s20
        end do                                                          1d14s10
 3303   format(7es15.7)
       end do                                                           1d14s10
       if(ldeb)then
        write(6,*)('x'),iflag
        call prntm2(bc(icartabcd),lap*lbp,lcp*ldp,lap*lbp)
        write(6,*)('y')
        call prntm2(bc(icartabcdy),lap*lbp,lcp*ldp,lap*lbp)
        write(6,*)('z')
        call prntm2(bc(icartabcdz),lap*lbp,lcp*ldp,lap*lbp)
       end if
c     for normal
c     cartabcd is dimension la,lb,lc,ld,iad,ibd,icd,idd,ibrt
c     we can get all cases by appropriate offsets in icartabcd,y,z
c     ioffs(1,ixzy: order of a der
c     ioffs(2,ixyz: order of b der
c     ioffs(3,ixyz: order of c der
c     ioffs(4,ixyz: order of d der
c     ioffs(5,ixyz: breit fcn
       nabcd=lap*lbp*lcp*ldp                                            3d13s20
       if(ldeb)call second(timea)                                       3d16s20
       do ifcn=1,nfcn(icode)                                            3d13s20
        lcarti=icarti+ncarti*ioffss(ifcn,icode)-1                       3d13s20
        lcartabcd=icartabcd+nabcd*(ioffs(1,1,ifcn,icode)                3d13s20
     $       +nxd*(ioffs(2,1,ifcn,icode)+nxd*(ioffs(3,1,ifcn,icode)     3d16s20
     $       +nyd*(ioffs(4,1,ifcn,icode)+nyd*ioffs(5,1,ifcn,icode)))))  3d18s20
        lcartabcdy=icartabcdy+nabcd*(ioffs(1,2,ifcn,icode)              3d13s20
     $       +nxd*(ioffs(2,2,ifcn,icode)+nxd*(ioffs(3,2,ifcn,icode)     3d16s20
     $       +nyd*(ioffs(4,2,ifcn,icode)+nyd*ioffs(5,2,ifcn,icode)))))  3d18s20
        lcartabcdz=icartabcdz+nabcd*(ioffs(1,3,ifcn,icode)              3d13s20
     $       +nxd*(ioffs(2,3,ifcn,icode)+nxd*(ioffs(3,3,ifcn,icode)     3d16s20
     $       +nyd*(ioffs(4,3,ifcn,icode)+nyd*ioffs(5,3,ifcn,icode)))))  3d18s20
        rwgtu=rwgt*fmulx(min(4,ioffss(ifcn,icode)+1))                   3d13s20
        rwgtu=rwgtu*cfcn(ifcn,icode)                                    12d20s20
        iader=ioffs(1,1,ifcn,icode)+ioffs(1,2,ifcn,icode)               3d13s20
     $       +ioffs(1,3,ifcn,icode)                                     3d13s20
        if(iader.gt.0)rwgtu=rwgtu*(zza2**iader)                         3d13s20
        ibder=ioffs(2,1,ifcn,icode)+ioffs(2,2,ifcn,icode)               3d13s20
     $       +ioffs(2,3,ifcn,icode)                                     3d13s20
        if(ibder.gt.0)rwgtu=rwgtu*(zzb2**ibder)                         3d13s20
        icder=ioffs(3,1,ifcn,icode)+ioffs(3,2,ifcn,icode)               3d13s20
     $       +ioffs(3,3,ifcn,icode)                                     3d13s20
        if(icder.gt.0)rwgtu=rwgtu*(zzc2**icder)                         3d13s20
        idder=ioffs(4,1,ifcn,icode)+ioffs(4,2,ifcn,icode)               3d13s20
     $       +ioffs(4,3,ifcn,icode)                                     3d13s20
        if(idder.gt.0)rwgtu=rwgtu*(zzd2**idder)                         3d13s20
        jpowd=ipp(ldp)+1                                                 1d14s10
        do id=1,ibc(ipp(ldp))                                            1d14s10
         j1=ibc(jpowd)*nwdsabc+lcartabcd                                3d12s20
         j2=ibc(jpowd+1)*nwdsabc+lcartabcdy                             3d12s20
         j3=ibc(jpowd+2)*nwdsabc+lcartabcdz                             3d12s20
         jpowd=jpowd+3                                                   1d14s10
         jpowc=ipp(lcp)+1                                                1d14s10
         iadd=(id-1)*ibc(ipp(lcp))                                       1d14s10
         do ic=1,ibc(ipp(lcp))                                           1d14s10
          k1=ibc(jpowc)*nwdsab+j1                                        7d6s15
          k2=ibc(jpowc+1)*nwdsab+j2                                      7d6s15
          k3=ibc(jpowc+2)*nwdsab+j3                                      7d6s15
          jpowc=jpowc+3                                                  1d14s10
          jpowb=ipp(lbp)+1                                               1d14s10
          iadc=(iadd+ic-1)*ibc(ipp(lbp))                                 1d14s10
          do ib=1,ibc(ipp(lbp))                                          1d14s10
           i1=ibc(jpowb)*lap+k1                                          7d6s15
           i2=ibc(jpowb+1)*lap+k2                                        7d6s15
           i3=ibc(jpowb+2)*lap+k3                                        7d6s15
           jpowb=jpowb+3                                                 1d14s10
           jpowa=ipp(lap)+1                                              1d14s10
           iadb=(iadc+ib-1)*ibc(ipp(lap))+lcarti                        3d12s20
           do ia=1,ibc(ipp(lap))                                         1d14s10
            l1=ibc(jpowa)+i1                                             7d6s15
            l2=ibc(jpowa+1)+i2                                           7d6s15
            l3=ibc(jpowa+2)+i3                                           7d6s15
            jpowa=jpowa+3                                                1d21s10
            iada=iadb+ia                                                 1d14s10
            bc(iada)=bc(iada)+bc(l1)*bc(l2)*bc(l3)*rwgtu                3d13s20
           end do                                                        1d14s10
          end do                                                         1d14s10
         end do                                                          1d14s10
        end do                                                           1d14s10
       end do                                                           3d12s20
       if(ldeb)then                                                     3d16s20
        call second(timeb)                                              3d16s20
        telap=timeb-timea-tovr                                          3d16s20
        tsto=tsto+telap                                                 3d16s20
       end if                                                           3d16s20
      end do                                                            1d14s10
      if(ldeb)then                                                      3d16s20
       call second(time2)                                               3d16s20
       telap=time2-time1-tovr                                           3d16s20
       write(6,*)('total nqr time: '),telap                             3d16s20
       write(6,*)('total sto time: '),tsto                              3d16s20
      end if                                                            3d16s20
      sz0=0d0                                                           1d21s10
      do i=1,ncarti                                                     1d21s10
       sz0=sz0+bc(icarti+i-1)**2                                        1d21s10
      end do                                                            1d21s10
      sz0=sqrt(sz0/dfloat(ncarti))                                      1d21s10
      if(sz0.ne.sz0)then
       write(6,*)('not a number!!! ')
            call dws_sync
            call dws_finalize
       stop
      end if
      jcarti=icarti                                                     1d14s10
      jcartt=icartt                                                     1d14s10
      nabc=ibc(ipp(lap))*ibc(ipp(lbp))*ibc(ipp(lcp))                    1d14s10
      nabcd=nabc*ibc(ipp(ldp))                                          3d13s20
      if(ldeb)then
       write(6,*)('cartesian form ')
       nrow=ibc(ipp(lap))*ibc(ipp(lbp))
       ncol=ibc(ipp(lcp))*ibc(ipp(ldp))
       istrt=1                                                          3d13s20
       do ifcn=0,nfcns(icode)                                           3d13s20
        lcarti=icarti+nabcd*ifcn                                        3d13s20
        write(6,*)('for fcn no. '),ifcn,lcarti-icarti,istrt
        do jfcn=istrt,nfcn(icode)                                       3d13s20
         write(6,*)('test '),jfcn,ioffss(jfcn,icode)
         if(ioffss(jfcn,icode).eq.ifcn)then                             3d13s20
          do i=1,5
           write(6,*)(ioffs(i,j,jfcn,icode),j=1,3)
          end do                                                        3d13s20
         else                                                           3d13s20
          istrt=jfcn                                                    3d13s20
          go to 2523                                                    3d13s20
         end if                                                         3d13s20
        end do
 2523   continue                                                        3d13s20
        call prntm2(bc(lcarti),nrow,ncol,nrow)
       end do                                                           3d12s20
      end if
      if(ldeb)call second(time1)                                        3d16s20
      if(ncot(icode).gt.0)then                                          11d4s21
       nrow=ibc(ipp(lap))*ibc(ipp(lbp))                                 11d4s21
       ncol=ibc(ipp(lcp))*ibc(ipp(ldp))                                 11d4s21
       need=nrow*ncol                                                   11d4s21
       needm=need-1                                                     11d4s21
       icot=ibcoff                                                      11d4s21
       ibcoff=icot+need*ncot(icode)                                     11d4s21
       call enough('dgerid.  5',bc,ibc)
       do iz=icot,ibcoff-1                                              11d4s21
        bc(iz)=0d0                                                      11d4s21
       end do                                                           11d4s21
       iin=1                                                            11d4s21
       do in=1,ncot(icode)                                              11d4s21
        ito=icot+need*(in-1)                                            11d4s21
        do im=1,nncot(in,icode)                                         11d4s21
         ff=dfloat(incot(iin+1,icode))                                  11d4s21
         ifrm=icarti+need*incot(iin,icode)                              11d4s21
         do ii=0,needm                                                  11d4s21
          bc(ito+ii)=bc(ito+ii)+ff*bc(ifrm+ii)                          11d4s21
         end do                                                         11d4s21
         iin=iin+2                                                      11d4s21
        end do                                                          11d4s21
       end do                                                           11d4s21
       icarti=icot                                                      11d4s21
       jcarti=icarti                                                    11d4s21
       nfcnsu=ncot(icode)                                               11d4s21
      else                                                              11d4s21
       nfcnsu=nfcns(icode)                                              11d4s21
      end if                                                            11d4s21
      if(iusecart.eq.0)then                                             2d21s20
       nab=ibc(ipp(lap))*ibc(ipp(lbp))                                  3d13s20
       ldt=2*ld+1                                                       3d13s20
       nabd=nab*ldt                                                     3d13s20
       lct=2*lc+1                                                        1d14s10
       lcdt=lct*ldt
       ncda=lcdt*ibc(ipp(lap))                                           1d14s10
       lbt=2*lb+1                                                        1d14s10
       ncdb=lcdt*lbt                                                     1d29s10
       lat=2*la+1                                                       3d13s20
       nabcdl=lcdt*lbt*lat                                              3d13s20
       do ifcn=0,nfcnsu                                                 11d4s21
        call cart2spher(bc(jcarti),bc(jcartt),nabc,ld,bc,ibc)           11d14s22
        do i=1,ldt                                                        1d14s10
         do j=1,ibc(ipp(lcp))                                             1d14s10
          iad1=jcartt-1+nab*(j-1+ibc(ipp(lcp))*(i-1))                     1d14s10
          iad2=jcarti-1+nab*(i-1+ldt*(j-1))                               1d14s10
          do k=1,nab                                                      1d14s10
           bc(iad2+k)=bc(iad1+k)                                        3d13s20
          end do                                                          1d14s10
         end do                                                           1d14s10
        end do                                                            1d14s10
        call cart2spher(bc(jcarti),bc(jcartt),nabd,lc,bc,ibc)           11d14s22
        do i=1,ibc(ipp(lap))                                              1d14s10
         do j=1,ibc(ipp(lbp))                                             1d14s10
          iad1=jcarti-1+lcdt*(i-1+ibc(ipp(lap))*(j-1))                    1d14s10
          do k=1,lcdt                                                     1d14s10
           iad2=jcartt+i-1+ibc(ipp(lap))*(j-1+ibc(ipp(lbp))*(k-1))        1d14s10
           bc(iad1+k)=bc(iad2)                                            1d14s10
          end do                                                          1d14s10
         end do                                                           1d14s10
        end do                                                            1d14s10
        call cart2spher(bc(jcarti),bc(jcartt),ncda,lb,bc,ibc)           11d14s22
        do i=1,ibc(ipp(lap))                                              1d14s10
         do j=1,lbt                                                       1d14s10
          iad1=jcartt-1+lcdt*(i-1+ibc(ipp(lap))*(j-1))                    1d14s10
          iad2=jcarti-1+lcdt*(j-1+lbt*(i-1))                              1d14s10
          do k=1,lcdt                                                     1d14s10
           bc(iad2+k)=bc(iad1+k)                                          1d14s10
          end do                                                          1d14s10
         end do                                                           1d14s10
        end do                                                            1d14s10
        call cart2spher(bc(jcarti),bc(jcartt),ncdb,la,bc,ibc)           11d14s22
        jcarti=jcarti+nabcd                                             3d13s20
        jcartt=jcartt+nabcdl                                            3d13s20
       end do                                                           3d13s20
       if(ldeb)then
        call second(time2)                                              3d16s20
        telap=time2-time1-tovr                                          3d16s20
        write(6,*)('cart to sphere time: '),telap
       end if
      else                                                              2d21s20
       icartt=icarti                                                    2d21s20
      end if                                                            2d21s20
      ibcoff=inode1
      return
      end
